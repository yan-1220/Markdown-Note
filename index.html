<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Note Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Markmap Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>
    <!-- Dexie.js for IndexedDB -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <style>
        /* çº¯é»‘è‰²èƒŒæ™¯ä¸»é¢˜ */
        body { background-color: #000000 !important; }
        .bg-gray-900 { background-color: #000000 !important; }
        .bg-gray-800 { background-color: #0a0a0a !important; }
        .bg-gray-700 { background-color: #1a1a1a !important; }
        .border-gray-700 { border-color: #2a2a2a !important; }
        .border-gray-600 { border-color: #333333 !important; }

        .note-list-item { transition: background-color 0.2s; }
        .note-list-item:hover { background-color: rgba(59, 130, 246, 0.25); }
        .note-list-item.active { background-color: rgba(59, 130, 246, 0.35); border-left: 4px solid #3b82f6; }
        .markdown-preview {
            line-height: 1.6;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 'Microsoft YaHei', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: #9ca3af;
        }
        .markdown-preview h1 { font-size: 2em; font-weight: 900; margin: 0.67em 0; color: #ffffff; border-bottom: 2px solid #2a2a2a; padding-bottom: 0.3em; text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
        .markdown-preview h2 { font-size: 1.5em; font-weight: 900; margin: 0.83em 0; color: #ffffff; border-bottom: 1px solid #2a2a2a; padding-bottom: 0.3em; text-shadow: 0 0 8px rgba(255, 255, 255, 0.25); }
        .markdown-preview h3 { font-size: 1.17em; font-weight: 800; margin: 1em 0; color: #ffffff; text-shadow: 0 0 6px rgba(255, 255, 255, 0.2); }
        .markdown-preview h4 { font-size: 1em; font-weight: 700; margin: 1em 0; color: #d1d5db; }
        .markdown-preview h5 { font-size: 0.875em; font-weight: 700; margin: 1em 0; color: #d1d5db; }
        .markdown-preview h6 { font-size: 0.85em; font-weight: 700; margin: 1em 0; color: #9ca3af; }
        .markdown-preview p { margin-bottom: 1em; color: #9ca3af; }
        .markdown-preview ul { list-style-type: disc; margin-left: 2em; margin-bottom: 1em; padding-left: 0; }
        .markdown-preview ol { list-style-type: decimal; margin-left: 2em; margin-bottom: 1em; padding-left: 0; }
        .markdown-preview li { margin-left: 1em; margin-bottom: 0.5em; }
        .markdown-preview code { background-color: #1a1a1a; color: #e5e7eb; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; border: 1px solid #2a2a2a; }
        .markdown-preview pre { background-color: #0a0a0a; padding: 1em; border-radius: 5px; overflow-x: auto; margin-bottom: 1em; border: 1px solid #2a2a2a; }
        .markdown-preview pre code { background-color: transparent; padding: 0; border: none; }
        .markdown-preview blockquote { border-left: 4px solid #3b82f6; padding-left: 1em; margin: 0 0 1em 0; color: #6b7280; background-color: #0a0a0a; padding: 1em; border-radius: 3px; }
        .markdown-preview table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
        .markdown-preview table th { background-color: #1a1a1a; color: #ffffff; font-weight: bold; padding: 0.75em; text-align: left; border: 1px solid #2a2a2a; }
        .markdown-preview table td { padding: 0.75em; border: 1px solid #2a2a2a; }
        .markdown-preview table tr:nth-child(even) { background-color: #0a0a0a; }
        .markdown-preview table tr:hover { background-color: rgba(59, 130, 246, 0.15); }
        .markdown-preview a { color: #60a5fa; text-decoration: underline; }
        .markdown-preview a:hover { color: #93c5fd; }
        .markdown-preview hr { border: none; border-top: 1px solid #4b5563; margin: 1.5em 0; }
        .markdown-preview img { max-width: 100%; height: auto; border-radius: 5px; margin: 1em 0; }
        .markdown-preview del { text-decoration: line-through; opacity: 0.7; }
        .markdown-preview strong {
            font-weight: 900;
            color: #ffffff;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.5),
                0 0 20px rgba(255, 255, 255, 0.3),
                0 0 30px rgba(255, 255, 255, 0.15);
            letter-spacing: 0.01em;
        }
        .markdown-preview em { font-style: italic; color: #6b7280; }
        .markdown-preview strong em, .markdown-preview em strong {
            font-weight: 900;
            font-style: italic;
            color: #ffffff;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.5),
                0 0 20px rgba(255, 255, 255, 0.3),
                0 0 30px rgba(255, 255, 255, 0.15);
        }
        .markdown-preview ul.contains-task-list { list-style: none !important; margin-left: 1em; padding-left: 0; }
        .markdown-preview ul.contains-task-list li { margin-left: 0; }
        .markdown-preview input[type="checkbox"] { margin-right: 0.5em; cursor: pointer; }
        .markdown-preview input[type="checkbox"]:disabled { cursor: default; }
        .markdown-preview sup { vertical-align: super; font-size: smaller; }
        .markdown-preview sub { vertical-align: sub; font-size: smaller; }
        #noteTitle:disabled { opacity: 1; cursor: default; }

        /* Markmapå®¹å™¨æ ·å¼ */
        #markmapSection {
            flex: 1;
            background: radial-gradient(circle at center, #0a0a0a 0%, #000000 100%);
            overflow: hidden;
            position: relative;
        }

        /* æ·»åŠ ç½‘æ ¼èƒŒæ™¯æ•ˆæœ */
        #markmapSection::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                linear-gradient(90deg, rgba(96, 165, 250, 0.05) 1px, transparent 1px),
                linear-gradient(rgba(96, 165, 250, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            opacity: 0.3;
            z-index: 0;
        }

        #markmapSection svg {
            width: 100%;
            height: 100%;
            display: block;
            position: relative;
            z-index: 1;
        }

        /* Markmapæ–‡å­—æ ·å¼ - æ›´å¤§æ›´æ¸…æ™° */
        #markmapSection svg text,
        #markmapSection svg tspan {
            fill: #374151 !important;
            font-size: 18px !important;
            font-weight: 400 !important;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8), 0 0 3px rgba(0, 0, 0, 0.9) !important;
        }

        #markmapSection svg strong,
        #markmapSection svg b {
            fill: #ffffff !important;
            font-weight: 900 !important;
            text-shadow:
                0 0 15px rgba(255, 255, 255, 0.6),
                0 0 25px rgba(255, 255, 255, 0.4),
                0 0 35px rgba(255, 255, 255, 0.2) !important;
        }

        /* ä¼˜åŒ–è¿æ¥çº¿ */
        #markmapSection svg path.markmap-link {
            stroke-width: 2.5px !important;
            opacity: 0.6 !important;
        }

        /* ä¼˜åŒ–èŠ‚ç‚¹åœ†åœˆ */
        #markmapSection svg circle {
            stroke-width: 3px !important;
            filter: drop-shadow(0 0 8px currentColor) brightness(1.2) !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
        }

        #markmapSection svg circle:hover {
            filter: drop-shadow(0 0 12px currentColor) brightness(1.4) !important;
            transform: scale(1.1) !important;
        }

        /* ä¼˜åŒ–æ–‡å­—æè¾¹æ•ˆæœ */
        #markmapSection svg foreignObject {
            overflow: visible !important;
        }

        #markmapSection svg foreignObject div {
            color: #f3f4f6 !important;
            text-shadow:
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000,
                0 0 8px rgba(0, 0, 0, 0.9),
                0 0 4px rgba(0, 0, 0, 0.8) !important;
            font-weight: 500 !important;
        }

        /* æ ¹èŠ‚ç‚¹ç‰¹æ®Šæ ·å¼ */
        #markmapSection svg > g > g:first-child circle {
            stroke-width: 4px !important;
            filter: drop-shadow(0 0 12px currentColor) brightness(1.3) !important;
        }

        #markmapSection svg > g > g:first-child text {
            font-size: 20px !important;
            font-weight: 700 !important;
        }

        /* ä»£ç åŒºå—æ ·å¼ä¼˜åŒ– - æ·±ç°èƒŒæ™¯ */
        #markmapSection svg code,
        #markmapSection svg foreignObject code {
            background-color: #1e1e1e !important;
            color: #d4d4d4 !important;
            padding: 3px 8px !important;
            border-radius: 4px !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            font-size: 14px !important;
            font-weight: 400 !important;
            border: 1px solid #3a3a3a !important;
            text-shadow: none !important;
        }

        #markmapSection svg pre,
        #markmapSection svg foreignObject pre {
            background-color: #1e1e1e !important;
            color: #d4d4d4 !important;
            padding: 12px !important;
            border-radius: 6px !important;
            border: 1px solid #3a3a3a !important;
            margin: 4px 0 !important;
        }

        #markmapSection svg pre code,
        #markmapSection svg foreignObject pre code {
            background-color: transparent !important;
            border: none !important;
            padding: 0 !important;
        }

        /* ç¡®ä¿ä»£ç åŒºå—å†…çš„æ–‡å­—ä¸ç»§æ‰¿æè¾¹æ•ˆæœ */
        #markmapSection svg code *,
        #markmapSection svg pre *,
        #markmapSection svg foreignObject code *,
        #markmapSection svg foreignObject pre * {
            text-shadow: none !important;
            stroke: none !important;
            font-weight: 400 !important;
        }

        /* è¡Œå†…ä»£ç æ ·å¼ */
        #markmapSection svg foreignObject div code {
            background-color: #1e1e1e !important;
            color: #d4d4d4 !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            font-size: 13px !important;
            font-weight: 400 !important;
            border: 1px solid #3a3a3a !important;
        }

        /* å…¨å±æ¨¡å¼æ ·å¼ */
        .fullscreen-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            background-color: #000000 !important;
            flex: none !important;
        }

        .fullscreen-mode .fullscreen-content {
            width: 100% !important;
            height: calc(100% - 48px) !important;
        }

        /* å…¨å±æ—¶çš„æ ‡é¢˜æ  */
        .fullscreen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: #0a0a0a;
            border-bottom: 1px solid #2a2a2a;
        }

        /* å…¨å±æŒ‰é’®æ ·å¼ */
        .fullscreen-btn {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .fullscreen-btn:hover {
            background-color: rgba(59, 130, 246, 0.2);
        }

        /* å¯æ‹–åŠ¨åˆ†éš”æ¡æ ·å¼ */
        .resize-handle {
            width: 4px;
            background-color: #2a2a2a;
            cursor: col-resize;
            flex-shrink: 0;
            position: relative;
            transition: background-color 0.2s;
        }

        .resize-handle:hover {
            background-color: #3b82f6;
        }

        .resize-handle:active {
            background-color: #60a5fa;
        }

        /* æ‹–åŠ¨æ—¶çš„è§†è§‰åé¦ˆ */
        .resize-handle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 40px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(59, 130, 246, 0.1) 25%,
                rgba(59, 130, 246, 0.2) 50%,
                rgba(59, 130, 246, 0.1) 75%,
                transparent 100%);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }

        .resize-handle:hover::after {
            opacity: 1;
        }

        /* æ‹–åŠ¨æ—¶ç¦ç”¨é€‰æ‹© */
        body.resizing {
            user-select: none;
            cursor: col-resize !important;
        }

        body.resizing * {
            cursor: col-resize !important;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div class="h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-white px-4 py-3 shadow-lg border-b border-gray-700">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold tracking-tight">ğŸ“ Markdown Note Cloud</h1>
                <div class="flex items-center gap-3">
                    <span id="dbStatus" class="text-xs text-gray-400 bg-gray-800/50 px-3 py-1.5 rounded-full border border-gray-700">ğŸ’¾ IndexedDB å„²å­˜æ¨¡å¼</span>
                    <button id="helpBtn" class="bg-blue-600 hover:bg-blue-700 text-white py-1.5 px-4 rounded-lg text-xs font-semibold transition-all hover:shadow-lg hover:shadow-blue-500/20">
                        â“ ä½¿ç”¨èªªæ˜
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-72 bg-gray-800 border-r border-gray-700/50 flex flex-col">
                <div class="p-3 border-b border-gray-700/50 space-y-2">
                    <button id="newNoteBtn" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all shadow-md hover:shadow-lg hover:shadow-blue-500/30">
                        â• æ–°å¢ç­†è¨˜
                    </button>
                    <button id="overviewBtn" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-all shadow-md hover:shadow-lg hover:shadow-indigo-500/30">
                        ğŸ“‹ ç­†è¨˜ç¸½è¦½
                    </button>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="exportBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-1.5 px-3 rounded-lg text-xs transition-all">
                            ğŸ“¤ åŒ¯å‡º
                        </button>
                        <button id="importBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-1.5 px-3 rounded-lg text-xs transition-all">
                            ğŸ“¥ åŒ¯å…¥
                        </button>
                    </div>
                    <button id="autoBackupBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-1.5 px-3 rounded-lg text-xs transition-all">
                        ğŸ’¾ è¨­å®šè‡ªå‹•å‚™ä»½
                    </button>
                    <div id="autoBackupStatus" class="text-xs text-green-400 text-center hidden bg-green-500/10 py-1 rounded">
                        ğŸ”„ è‡ªå‹•å‚™ä»½å·²å•Ÿç”¨
                    </div>
                    <input type="file" id="importFileInput" accept=".json" class="hidden">
                </div>
                <div class="p-3 border-b border-gray-700/50">
                    <div class="relative">
                        <input
                            id="searchInput"
                            type="text"
                            placeholder="ğŸ” æœå°‹ç­†è¨˜..."
                            class="w-full bg-gray-700/50 text-gray-100 placeholder-gray-400 rounded-lg py-2 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500 border border-gray-600/50 focus:border-blue-500/50 transition-all">
                        <button id="clearSearchBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200 hidden">
                            âœ•
                        </button>
                    </div>
                    <div id="searchStats" class="mt-2 text-xs text-blue-400 bg-blue-500/10 px-2 py-1 rounded hidden">
                        æ‰¾åˆ° <span id="searchCount">0</span> ç­†çµæœ
                    </div>
                </div>
                <div id="noteList" class="flex-1 overflow-y-auto"></div>
            </aside>

            <!-- Editor -->
            <main class="flex-1 flex flex-col bg-gray-800">
                <div class="px-3 py-2 border-b border-gray-700/50 bg-gradient-to-b from-gray-800 to-gray-800/95">
                    <div class="flex items-center justify-between gap-3">
                        <input id="noteTitle" type="text" placeholder="è¼¸å…¥ç­†è¨˜æ¨™é¡Œ..."
                               class="flex-1 text-base font-bold outline-none bg-transparent text-gray-100 placeholder-gray-500/70 disabled:cursor-default" disabled>

                        <!-- Tags and Timestamp in one line -->
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <div class="flex flex-wrap gap-1 items-center">
                                <div id="tagsContainer" class="flex flex-wrap gap-1">
                                    <!-- Tags will be displayed here -->
                                </div>
                                <input id="tagInput" type="text" placeholder="+ æ¨™ç±¤" list="tagSuggestions"
                                       class="w-16 px-2 py-0.5 text-xs bg-gray-700/50 text-gray-100 placeholder-gray-500 rounded-md outline-none focus:ring-1 focus:ring-blue-500 border border-gray-600/50 focus:border-blue-500/50 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                       disabled>
                                <datalist id="tagSuggestions">
                                    <!-- Tag suggestions will be populated dynamically -->
                                </datalist>
                            </div>
                            <div id="noteTimestamp" class="text-xs text-gray-500 flex items-center gap-2 hidden">
                                <span id="createdTime" class="flex items-center gap-1">ğŸ“…</span>
                                <span class="text-gray-600">â€¢</span>
                                <span id="updatedTime" class="flex items-center gap-1">ğŸ”„</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex-1 flex overflow-hidden">
                    <div id="editorSection" class="flex-1 flex flex-col">
                        <div class="px-3 py-1.5 bg-gray-900 border-b border-gray-700">
                            <span class="text-xs font-medium text-gray-400">âœï¸ ç·¨è¼¯å™¨</span>
                        </div>
                        <textarea id="noteContent" placeholder="åœ¨æ­¤è¼¸å…¥ Markdown å…§å®¹..."
                                  class="flex-1 p-4 outline-none resize-none font-mono text-sm bg-gray-800 text-gray-100 placeholder-gray-500" disabled></textarea>
                    </div>
                    <div id="resizeHandle" class="resize-handle" title="æ‹–å‹•èª¿æ•´å¤§å°"></div>
                    <div id="previewSection" class="flex-1 flex flex-col">
                        <div class="px-3 py-1.5 bg-gray-900 border-b border-gray-700 flex justify-between items-center">
                            <span class="text-xs font-medium text-gray-400">ğŸ“„ Markdown</span>
                            <button id="previewFullscreenBtn" class="fullscreen-btn text-gray-400 hover:text-gray-200 text-base" title="å…¨å±æŸ¥çœ‹">
                                â›¶
                            </button>
                        </div>
                        <div id="markdownPreview" class="fullscreen-content flex-1 p-4 overflow-y-auto markdown-preview text-gray-100">
                            <p class="text-gray-500">Markdown æ¸²æŸ“å€åŸŸ</p>
                        </div>
                    </div>
                    <div id="markmapSection" class="hidden flex-1 flex-col">
                        <div class="px-3 py-1.5 bg-gray-900 border-b border-gray-700 flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-medium text-gray-400">ğŸ—ºï¸ æ€ç¶­å°åœ–</span>
                                <div class="flex gap-1">
                                    <button id="expandAllBtn" class="bg-green-600 hover:bg-green-700 text-white text-xs py-0.5 px-2 rounded transition-colors" title="å±•é–‹æ‰€æœ‰ç¯€é»">
                                        â• å±•é–‹
                                    </button>
                                    <button id="collapseAllBtn" class="bg-orange-600 hover:bg-orange-700 text-white text-xs py-0.5 px-2 rounded transition-colors" title="æ‘ºç–Šæ‰€æœ‰ç¯€é»">
                                        â– æ‘ºç–Š
                                    </button>
                                    <button id="fitViewBtn" class="bg-blue-600 hover:bg-blue-700 text-white text-xs py-0.5 px-2 rounded transition-colors" title="é©é…è¦–åœ–">
                                        ğŸ¯ é©é…
                                    </button>
                                </div>
                            </div>
                            <button id="markmapFullscreenBtn" class="fullscreen-btn text-gray-400 hover:text-gray-200 text-base" title="å…¨å±æŸ¥çœ‹">
                                â›¶
                            </button>
                        </div>
                        <div id="markmapContainer" class="fullscreen-content flex-1">
                            <svg id="markmapSvg"></svg>
                        </div>
                    </div>
                </div>
                <div class="px-3 py-2 border-t border-gray-700/50 flex justify-between items-center bg-gradient-to-t from-gray-800 to-gray-800/95">
                    <div class="flex items-center gap-2">
                        <span id="saveStatus" class="text-xs text-gray-400 bg-gray-700/30 px-2.5 py-1 rounded-full border border-gray-700/50">è«‹é¸æ“‡æˆ–å»ºç«‹ç­†è¨˜</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <button id="viewModeBtn" class="bg-purple-600 hover:bg-purple-700 text-white py-1 px-3 rounded-lg text-xs font-medium disabled:bg-gray-600 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg disabled:shadow-none" disabled>
                            ğŸ—ºï¸ æ€ç¶­å°åœ–
                        </button>
                        <button id="toggleModeBtn" class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded-lg text-xs font-medium disabled:bg-gray-600 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg disabled:shadow-none" disabled>
                            âœï¸ ç·¨è¼¯
                        </button>
                        <button id="deleteNoteBtn" class="bg-red-600 hover:bg-red-700 text-white py-1 px-3 rounded-lg text-xs font-medium disabled:bg-gray-600 disabled:cursor-not-allowed transition-all shadow-md hover:shadow-lg disabled:shadow-none" disabled>
                            ğŸ—‘ï¸ åˆªé™¤
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <!-- Modal Header -->
                <div class="sticky top-0 bg-gray-800 border-b border-gray-700 p-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-100">ğŸ“– ä½¿ç”¨èªªæ˜</h2>
                    <button id="closeHelpBtn" class="text-gray-400 hover:text-gray-200 text-3xl leading-none">
                        Ã—
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="p-6 text-gray-200 space-y-6">
                    <!-- é–‹ç™¼è€…è³‡è¨Š -->
                    <div class="text-left py-2 border-b border-gray-600">
                        <p class="text-gray-300">é–‹ç™¼è€… - <span class="text-blue-400 font-semibold">QAé™³å½¥è‰¯</span></p>
                    </div>

                    <!-- åŠŸèƒ½ä»‹ç´¹ -->
                    <section>
                        <h3 class="text-xl font-bold text-blue-400 mb-3">âœ¨ åŠŸèƒ½ç‰¹è‰²</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-300">
                            <li><strong class="text-green-400">ğŸš€ IndexedDB å„²å­˜ï¼š</strong>é–‹ç®±å³ç”¨ï¼Œç„¡éœ€è¨­å®šï¼Œè‡ªå‹•å„²å­˜æ‰€æœ‰ç­†è¨˜</li>
                            <li>ğŸ“„ æ”¯æ´å®Œæ•´ GitHub Flavored Markdown (GFM) èªæ³•</li>
                            <li>ğŸ—ºï¸ æ€ç¶­å°åœ–è¦–åœ–ï¼šå°‡ç­†è¨˜è½‰æ›ç‚ºäº’å‹•å¼å¿ƒæ™ºåœ–</li>
                            <li>ğŸ·ï¸ æ¨™ç±¤ç®¡ç†ï¼šæ”¯æ´å¤šæ¨™ç±¤åˆ†é¡ï¼Œè‡ªå‹•å®Œæˆè¼¸å…¥ï¼ŒæŒ‰æ¨™ç±¤ç¯©é¸ç­†è¨˜</li>
                            <li>ğŸ“‹ ç­†è¨˜ç¸½è¦½ï¼šç·Šæ¹Šå¼åˆ—è¡¨é¡¯ç¤ºæ‰€æœ‰ç­†è¨˜ï¼Œæ”¯æ´æ’åºå’Œç¯©é¸</li>
                            <li>â›¶ å…¨å±æ¨¡å¼ï¼šMarkdown èˆ‡æ€ç¶­å°åœ–å¯åˆ‡æ›ç‚ºå…¨ç€è¦½å™¨ç¯„åœæŸ¥çœ‹</li>
                            <li>â†”ï¸ å¯èª¿æ•´ç·¨è¼¯å™¨èˆ‡é è¦½å€åŸŸçš„å¯¬åº¦æ¯”ä¾‹ï¼Œé›™æ“Šé‡ç½®</li>
                            <li>ğŸ¨ ç¨‹å¼ç¢¼èªæ³•é«˜äº®ï¼šæ”¯æ´ 180+ ç¨®ç¨‹å¼èªè¨€</li>
                            <li>âœ… æ”¯æ´ä»»å‹™åˆ—è¡¨ã€è¡¨æ ¼ã€åˆªé™¤ç·šç­‰ GFM æ“´å±•èªæ³•</li>
                            <li>âœï¸ ä¸‰ç¨®è¦–åœ–æ¨¡å¼ï¼šé–±è®€ / ç·¨è¼¯ / æ€ç¶­å°åœ–</li>
                            <li>ğŸ” å…¨æ–‡æª¢ç´¢ï¼šå³æ™‚æœå°‹æ¨™é¡Œå’Œå…§å®¹ï¼Œé—œéµå­—é«˜äº®é¡¯ç¤º</li>
                            <li>ğŸ“¤ğŸ“¥ è³‡æ–™åŒ¯å‡º/åŒ¯å…¥ï¼šæ”¯æ´å‚™ä»½å’Œé‚„åŸæ‰€æœ‰ç­†è¨˜</li>
                            <li>ğŸ“… æ™‚é–“æ¨™è¨˜ï¼šè‡ªå‹•è¨˜éŒ„å»ºç«‹æ™‚é–“èˆ‡æœ€å¾Œæ›´æ–°æ™‚é–“</li>
                            <li>ğŸ’¾ è‡ªå‹•å„²å­˜ï¼šç·¨è¼¯å¾Œ 1.5 ç§’è‡ªå‹•å„²å­˜åˆ° IndexedDB</li>
                            <li>ğŸŒ“ ç´”é»‘æ·±è‰²æ¨¡å¼ï¼šOLED å‹å–„çš„ç´”é»‘ç•Œé¢</li>
                            <li>ğŸ” å®‰å…¨ä¿è­·ï¼šé˜²æ­¢ XSS æ”»æ“Š</li>
                        </ul>
                    </section>

                    <!-- åŸºæœ¬æ“ä½œ -->
                    <section>
                        <h3 class="text-xl font-bold text-green-400 mb-3">ğŸ“ åŸºæœ¬æ“ä½œ</h3>

                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">1ï¸âƒ£ å»ºç«‹ç­†è¨˜</h4>
                                <p class="text-gray-300 ml-4">é»æ“Šå·¦å´é¢æ¿çš„ã€Œâ• æ–°å¢ç­†è¨˜ã€æŒ‰éˆ•ï¼Œç³»çµ±æœƒè‡ªå‹•å»ºç«‹ä¸€ç¯‡æ–°ç­†è¨˜ä¸¦é€²å…¥ç·¨è¼¯æ¨¡å¼ã€‚</p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">2ï¸âƒ£ ç·¨è¼¯ç­†è¨˜</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ é»æ“Šç­†è¨˜åˆ—è¡¨ä¸­çš„ä»»ä¸€ç­†è¨˜ï¼Œé è¨­æœƒé€²å…¥ <strong>Markdown æ¨¡å¼</strong>ï¼ˆç´”é–±è®€ï¼‰<br>
                                    â€¢ é»æ“Šå³ä¸‹è§’ã€Œâœï¸ ç·¨è¼¯ã€æŒ‰éˆ•é€²å…¥ç·¨è¼¯æ¨¡å¼<br>
                                    â€¢ åœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œå·¦å´ç‚ºç·¨è¼¯å™¨ï¼Œå³å´å³æ™‚é è¦½ Markdown æ¸²æŸ“çµæœ<br>
                                    â€¢ <strong>å¯æ‹–å‹•ä¸­é–“åˆ†éš”æ¢</strong>èª¿æ•´ç·¨è¼¯å™¨èˆ‡é è¦½å€åŸŸçš„å¯¬åº¦<br>
                                    â€¢ é›™æ“Šåˆ†éš”æ¢å¯å¿«é€Ÿé‡ç½®ç‚º 50/50 æ¯”ä¾‹<br>
                                    â€¢ èª¿æ•´çš„å¯¬åº¦è¨­å®šæœƒè‡ªå‹•ä¿å­˜ï¼Œä¸‹æ¬¡é–‹å•Ÿæ™‚ä¿æŒç›¸åŒæ¯”ä¾‹<br>
                                    â€¢ å®Œæˆç·¨è¼¯å¾Œé»æ“Šã€Œâœ… å®Œæˆã€è¿”å› Markdown æ¨¡å¼
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">3ï¸âƒ£ æ€ç¶­å°åœ–è¦–åœ–</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ é¸æ“‡ç­†è¨˜å¾Œï¼Œé»æ“Šå³ä¸‹è§’ã€ŒğŸ—ºï¸ æ€ç¶­å°åœ–ã€æŒ‰éˆ•<br>
                                    â€¢ ç­†è¨˜æœƒè‡ªå‹•è½‰æ›ç‚ºå½©è‰²äº’å‹•å¼å¿ƒæ™ºåœ–<br>
                                    â€¢ é»æ“Šç¯€é»åœ“åœˆå¯å±•é–‹/æ”¶èµ·åˆ†æ”¯<br>
                                    â€¢ æ»¾å‹•æ»‘é¼ æ»¾è¼ªå¯ç¸®æ”¾è¦–åœ–<br>
                                    â€¢ æ‹–æ›³å¯ç§»å‹•è¦–åœ–ä½ç½®<br>
                                    â€¢ é»æ“Šã€ŒğŸ“„ è¿”å›é–±è®€ã€è¿”å›æ­£å¸¸è¦–åœ–
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">4ï¸âƒ£ å…¨å±æ¨¡å¼</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ åœ¨ Markdown é–±è®€æ¨¡å¼æˆ–æ€ç¶­å°åœ–æ¨¡å¼ä¸‹ï¼Œé»æ“Šå³ä¸Šè§’çš„ â›¶ æŒ‰éˆ•é€²å…¥å…¨å±<br>
                                    â€¢ å…¨å±æ¨¡å¼ä¸‹å¯ä»¥æ›´å°ˆæ³¨åœ°é–±è®€æˆ–æŸ¥çœ‹æ€ç¶­å°åœ–<br>
                                    â€¢ é»æ“Š â›‰ æŒ‰éˆ•æˆ–æŒ‰ ESC éµé€€å‡ºå…¨å±<br>
                                    â€¢ å…¨å±æ¨¡å¼æœƒè‡ªå‹•èª¿æ•´è¦–åœ–å¤§å°ä»¥æœ€ä½³åŒ–é¡¯ç¤º
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">5ï¸âƒ£ æ¨™ç±¤ç®¡ç†</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ é¸æ“‡ç­†è¨˜å¾Œï¼Œåœ¨æ¨™é¡Œä¸‹æ–¹çš„æ¨™ç±¤è¼¸å…¥æ¡†ä¸­è¼¸å…¥æ¨™ç±¤åç¨±<br>
                                    â€¢ é»æ“Šè¼¸å…¥æ¡†æœƒé¡¯ç¤ºå·²å­˜åœ¨çš„æ¨™ç±¤åˆ—è¡¨ï¼ˆæŒ‰ a-z æ’åºï¼‰<br>
                                    â€¢ å¯ä»¥é¸æ“‡ç¾æœ‰æ¨™ç±¤æˆ–è¼¸å…¥æ–°æ¨™ç±¤åç¨±<br>
                                    â€¢ æŒ‰ Enter éµæ–°å¢æ¨™ç±¤<br>
                                    â€¢ é»æ“Šæ¨™ç±¤ä¸Šçš„ã€ŒÃ—ã€åˆªé™¤è©²æ¨™ç±¤<br>
                                    â€¢ ä½¿ç”¨å·¦å´é¢æ¿çš„æ¨™ç±¤ç¯©é¸å™¨ï¼Œå¯ä»¥æŒ‰æ¨™ç±¤ç¯©é¸ç­†è¨˜
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">6ï¸âƒ£ ç­†è¨˜ç¸½è¦½</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ é»æ“Šå·¦å´é¢æ¿çš„ã€ŒğŸ“‹ ç­†è¨˜ç¸½è¦½ã€æŒ‰éˆ•<br>
                                    â€¢ ä»¥ç·Šæ¹Šåˆ—è¡¨å½¢å¼æŸ¥çœ‹æ‰€æœ‰ç­†è¨˜<br>
                                    â€¢ é¡¯ç¤ºç­†è¨˜æ¨™é¡Œã€å‰µå»ºæ—¥æœŸã€æ›´æ–°æ—¥æœŸå’Œæ¨™ç±¤<br>
                                    â€¢ æ”¯æ´æœå°‹å’Œæ’åºåŠŸèƒ½<br>
                                    â€¢ é»æ“Šç­†è¨˜æ¨™é¡Œå³å¯é–‹å•Ÿè©²ç­†è¨˜
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">7ï¸âƒ£ åˆªé™¤ç­†è¨˜</h4>
                                <p class="text-gray-300 ml-4">é¸æ“‡ç­†è¨˜å¾Œï¼Œé»æ“Šå³ä¸‹è§’ã€ŒğŸ—‘ï¸ åˆªé™¤ç­†è¨˜ã€æŒ‰éˆ•ï¼Œç¢ºèªå¾Œå³å¯åˆªé™¤ã€‚</p>
                            </div>
                        </div>
                    </section>

                    <!-- æœå°‹åŠŸèƒ½ -->
                    <section>
                        <h3 class="text-xl font-bold text-purple-400 mb-3">ğŸ” æœå°‹åŠŸèƒ½</h3>
                        <div class="text-gray-300 ml-4 space-y-2">
                            <p>â€¢ åœ¨å·¦å´é¢æ¿çš„æœå°‹æ¡†è¼¸å…¥é—œéµå­—</p>
                            <p>â€¢ ç³»çµ±æœƒå³æ™‚æœå°‹ç­†è¨˜æ¨™é¡Œå’Œå…§å®¹</p>
                            <p>â€¢ æœå°‹çµæœæœƒä»¥é»ƒè‰²é«˜äº®é¡¯ç¤ºé—œéµå­—</p>
                            <p>â€¢ é¡¯ç¤ºæ‰¾åˆ°çš„ç­†è¨˜æ•¸é‡çµ±è¨ˆ</p>
                            <p>â€¢ é»æ“Šã€Œâœ•ã€æˆ–æŒ‰ ESC éµæ¸…é™¤æœå°‹</p>
                        </div>
                    </section>

                    <!-- å„²å­˜ç³»çµ± -->
                    <section>
                        <h3 class="text-xl font-bold text-orange-400 mb-3">ğŸ’¾ IndexedDB å„²å­˜ç³»çµ±</h3>

                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸš€ é–‹ç®±å³ç”¨</h4>
                                <p class="text-gray-300 ml-4">
                                    æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ç€è¦½å™¨å…§å»ºçš„ <strong>IndexedDB</strong> è³‡æ–™åº«è‡ªå‹•å„²å­˜æ‰€æœ‰ç­†è¨˜ã€‚<br>
                                    ç„¡éœ€ä»»ä½•è¨­å®šæˆ–é¸æ“‡ç›®éŒ„ï¼Œé–‹å•Ÿå³å¯ä½¿ç”¨ï¼<br>
                                    <span class="text-green-400">âœ… æ¯” localStorage æ›´å¿«ã€æ›´ç©©å®šã€å®¹é‡æ›´å¤§</span>
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸ’¾ è‡ªå‹•å„²å­˜</h4>
                                <p class="text-gray-300 ml-4">
                                    æ‰€æœ‰çš„ç­†è¨˜ä¿®æ”¹éƒ½æœƒåœ¨ 1.5 ç§’å¾Œè‡ªå‹•å„²å­˜åˆ° IndexedDBã€‚<br>
                                    è³‡æ–™å„²å­˜åœ¨ç€è¦½å™¨æœ¬åœ°ï¼Œå®Œå…¨é›¢ç·šå¯ç”¨ï¼Œä¸æœƒä¸Šå‚³åˆ°ç¶²è·¯ã€‚<br>
                                    å³ä¸Šè§’æœƒé¡¯ç¤ºç•¶å‰å·²è¼‰å…¥çš„ç­†è¨˜æ•¸é‡ã€‚
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸ”„ è³‡æ–™é·ç§»</h4>
                                <p class="text-gray-300 ml-4">
                                    å¦‚æœæ‚¨ä¹‹å‰ä½¿ç”¨èˆŠç‰ˆæœ¬ï¼ˆlocalStorage å„²å­˜ï¼‰ï¼Œé¦–æ¬¡é–‹å•Ÿæ™‚æœƒè‡ªå‹•æª¢æ¸¬ä¸¦æç¤ºæ‚¨é·ç§»è³‡æ–™ã€‚<br>
                                    é¸æ“‡ã€Œç¢ºå®šã€å¾Œï¼Œç³»çµ±æœƒå°‡æ‰€æœ‰èˆŠè³‡æ–™è‡ªå‹•è½‰ç§»åˆ°æ–°çš„ IndexedDB è³‡æ–™åº«ä¸­ã€‚
                                </p>
                            </div>

                            <div class="bg-blue-900/30 p-3 rounded-lg">
                                <h4 class="font-semibold text-blue-300 mb-2">â„¹ï¸ é—œæ–¼ IndexedDB</h4>
                                <p class="text-gray-300 text-sm ml-4">
                                    IndexedDB æ˜¯ç€è¦½å™¨å…§å»ºçš„ NoSQL è³‡æ–™åº«ï¼Œæä¾›ï¼š<br>
                                    â€¢ æ›´å¤§çš„å„²å­˜ç©ºé–“ï¼ˆé€šå¸¸ 50MB èµ·è·³ï¼ŒæŸäº›ç€è¦½å™¨ç„¡é™åˆ¶ï¼‰<br>
                                    â€¢ æ›´å¿«çš„è®€å¯«é€Ÿåº¦<br>
                                    â€¢ æ”¯æ´ç´¢å¼•å’Œè¤‡é›œæŸ¥è©¢<br>
                                    â€¢ è³‡æ–™æŒä¹…ä¿å­˜ï¼ˆé™¤éæ‰‹å‹•æ¸…é™¤ç€è¦½å™¨è³‡æ–™ï¼‰
                                </p>
                            </div>
                        </div>
                    </section>

                    <!-- åŒ¯å‡ºåŒ¯å…¥ -->
                    <section>
                        <h3 class="text-xl font-bold text-yellow-400 mb-3">ğŸ’¾ è³‡æ–™å‚™ä»½èˆ‡é‚„åŸ</h3>

                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸ“¤ åŒ¯å‡ºè³‡æ–™</h4>
                                <p class="text-gray-300 ml-4">
                                    é»æ“Šå·¦å´é¢æ¿çš„ã€ŒğŸ“¤ åŒ¯å‡ºã€æŒ‰éˆ•ï¼Œç³»çµ±æœƒå°‡æ‰€æœ‰ç­†è¨˜åŒ¯å‡ºç‚º JSON æ ¼å¼æª”æ¡ˆã€‚<br>
                                    æª”æ¡ˆåç¨±æ ¼å¼ï¼š<code class="bg-gray-700 px-2 py-1 rounded">markdown-notes-backup-YYYY-MM-DD-HH-MM-SS.json</code><br>
                                    <span class="text-blue-400">ğŸ’¡ æç¤ºï¼šç¾åœ¨æ‚¨å·²ç¶“æœ‰è‡ªå‹•å„²å­˜çš„ JSON æª”æ¡ˆï¼ŒåŒ¯å‡ºåŠŸèƒ½ä¸»è¦ç”¨æ–¼å»ºç«‹é¡å¤–çš„å‚™ä»½ã€‚</span>
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸ“¥ åŒ¯å…¥è³‡æ–™</h4>
                                <p class="text-gray-300 ml-4">
                                    é»æ“Šå·¦å´é¢æ¿çš„ã€ŒğŸ“¥ åŒ¯å…¥ã€æŒ‰éˆ•ï¼Œé¸æ“‡ä¹‹å‰åŒ¯å‡ºçš„ JSON æª”æ¡ˆã€‚<br>
                                    ç³»çµ±æœƒé¡¯ç¤ºåŒ¯å…¥é è¦½è³‡è¨Šï¼Œä¸¦æä¾›å…©ç¨®åŒ¯å…¥æ¨¡å¼ï¼š<br>
                                    <span class="block mt-2">
                                        â€¢ <strong>è¦†è“‹æ¨¡å¼</strong>ï¼ˆé»æ“Šã€Œç¢ºå®šã€ï¼‰ï¼šåˆªé™¤ç¾æœ‰æ‰€æœ‰ç­†è¨˜ï¼Œå®Œå…¨æ›¿æ›ç‚ºåŒ¯å…¥çš„è³‡æ–™<br>
                                        â€¢ <strong>åˆä½µæ¨¡å¼</strong>ï¼ˆé»æ“Šã€Œå–æ¶ˆã€ï¼‰ï¼šä¿ç•™ç¾æœ‰ç­†è¨˜ï¼Œåªæ–°å¢ä¸é‡è¤‡çš„ç­†è¨˜
                                    </span>
                                </p>
                            </div>
                        </div>
                    </section>

                    <!-- Markdown èªæ³• -->
                    <section>
                        <h3 class="text-xl font-bold text-pink-400 mb-3">ğŸ“ Markdown èªæ³•åƒè€ƒ</h3>
                        <div class="bg-gray-900 p-4 rounded-lg text-sm space-y-3 font-mono text-gray-300">
                            <div>
                                <p class="text-blue-400 mb-1">æ¨™é¡Œï¼š</p>
                                <p># æ¨™é¡Œ 1  ## æ¨™é¡Œ 2  ### æ¨™é¡Œ 3</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">æ–‡å­—æ¨£å¼ï¼š</p>
                                <p>**ç²—é«”** *æ–œé«”* ~~åˆªé™¤ç·š~~</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">åˆ—è¡¨ï¼š</p>
                                <p>- é …ç›®åˆ—è¡¨</p>
                                <p>1. ç·¨è™Ÿåˆ—è¡¨</p>
                                <p>- [ ] ä»»å‹™åˆ—è¡¨ï¼ˆæœªå®Œæˆï¼‰</p>
                                <p>- [x] ä»»å‹™åˆ—è¡¨ï¼ˆå·²å®Œæˆï¼‰</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">é€£çµèˆ‡åœ–ç‰‡ï¼š</p>
                                <p>[é€£çµæ–‡å­—](https://example.com)</p>
                                <p>![åœ–ç‰‡æè¿°](åœ–ç‰‡ç¶²å€)</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">ç¨‹å¼ç¢¼ï¼š</p>
                                <p>`è¡Œå…§ç¨‹å¼ç¢¼`</p>
                                <p>```javascript<br>// ç¨‹å¼ç¢¼å€å¡Šï¼ˆæ”¯æ´èªæ³•é«˜äº®ï¼‰<br>console.log('Hello');<br>```</p>
                                <p class="text-xs text-gray-500 mt-1">* æ€ç¶­å°åœ–ä¸­ï¼Œç¨‹å¼ç¢¼æœƒä»¥æ·±ç°èƒŒæ™¯é¡¯ç¤º</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">å¼•ç”¨èˆ‡åˆ†éš”ç·šï¼š</p>
                                <p>&gt; å¼•ç”¨æ–‡å­—</p>
                                <p>---</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">è¡¨æ ¼ï¼š</p>
                                <p>| æ¬„ä½1 | æ¬„ä½2 |</p>
                                <p>|-------|-------|</p>
                                <p>| å…§å®¹1 | å…§å®¹2 |</p>
                            </div>
                        </div>
                    </section>

                    <!-- å¿«æ·æç¤º -->
                    <section>
                        <h3 class="text-xl font-bold text-cyan-400 mb-3">ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-300">
                            <li><strong class="text-green-400">é–‹ç®±å³ç”¨ï¼</strong> ä½¿ç”¨ IndexedDB è³‡æ–™åº«è‡ªå‹•å„²å­˜ï¼Œç„¡éœ€ä»»ä½•è¨­å®š</li>
                            <li>æ‰€æœ‰è³‡æ–™å„²å­˜åœ¨ç€è¦½å™¨æœ¬åœ°ï¼Œå®Œå…¨é›¢ç·šå¯ç”¨ï¼Œä¸æœƒä¸Šå‚³åˆ°ç¶²è·¯</li>
                            <li>ç­†è¨˜æŒ‰æœ€å¾Œæ›´æ–°æ™‚é–“æ’åºï¼Œæœ€æ–°çš„åœ¨æœ€ä¸Šæ–¹</li>
                            <li>ç·¨è¼¯æ™‚æœƒåœ¨ 1.5 ç§’å¾Œè‡ªå‹•å„²å­˜ï¼Œé¿å…è³‡æ–™éºå¤±</li>
                            <li>å³ä¸Šè§’é¡¯ç¤ºç•¶å‰å·²è¼‰å…¥çš„ç­†è¨˜æ•¸é‡</li>
                            <li>å®šæœŸä½¿ç”¨ã€ŒğŸ“¤ åŒ¯å‡ºã€åŠŸèƒ½å‚™ä»½é‡è¦ç­†è¨˜</li>
                            <li>æ¸…é™¤ç€è¦½å™¨è³‡æ–™æœƒå°è‡´ç­†è¨˜éºå¤±ï¼Œè«‹å‹™å¿…å…ˆå‚™ä»½</li>
                            <li>ç·¨è¼¯å™¨èˆ‡é è¦½å€åŸŸçš„å¯¬åº¦æ¯”ä¾‹æœƒè‡ªå‹•ä¿å­˜ï¼Œå¯ä¾å€‹äººç¿’æ…£èª¿æ•´</li>
                            <li><strong class="text-green-400">ç›¸å®¹æ€§ï¼š</strong> æ”¯æ´æ‰€æœ‰ç¾ä»£ç€è¦½å™¨ï¼ˆChromeã€Firefoxã€Safariã€Edge ç­‰ï¼‰</li>
                        </ul>
                    </section>

                    <!-- æŠ€è¡“è³‡è¨Š -->
                    <section class="border-t border-gray-700 pt-4">
                        <h3 class="text-lg font-bold text-gray-400 mb-2">ğŸ”§ æŠ€è¡“è³‡è¨Š</h3>
                        <p class="text-gray-400 text-sm">
                            æœ¬æ‡‰ç”¨ä½¿ç”¨ Tailwind CSSã€marked.jsï¼ˆMarkdown æ¸²æŸ“ï¼‰ã€highlight.jsï¼ˆç¨‹å¼ç¢¼èªæ³•é«˜äº®ï¼‰ã€<br>
                            markmapï¼ˆæ€ç¶­å°åœ–ï¼‰ã€D3.jsï¼ˆè³‡æ–™è¦–è¦ºåŒ–ï¼‰ã€DOMPurifyï¼ˆå®‰å…¨é˜²è­·ï¼‰é–‹ç™¼ã€‚<br>
                            ç´”å‰ç«¯æ‡‰ç”¨ï¼Œç„¡éœ€ä¼ºæœå™¨ï¼Œå¯é›¢ç·šä½¿ç”¨ã€‚
                        </p>
                    </section>
                </div>

                <!-- Modal Footer -->
                <div class="sticky bottom-0 bg-gray-800 border-t border-gray-700 p-4 flex justify-end">
                    <button id="closeHelpBtn2" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg font-semibold">
                        é—œé–‰
                    </button>
                </div>
            </div>
        </div>

        <!-- Overview Modal -->
        <div id="overviewModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-xl max-w-5xl w-full max-h-[90vh] flex flex-col shadow-2xl border border-gray-700/50">
                <!-- Modal Header -->
                <div class="bg-gradient-to-r from-gray-800 to-gray-800/95 border-b border-gray-700/50 px-5 py-3.5 flex justify-between items-center flex-shrink-0 rounded-t-xl">
                    <h2 class="text-xl font-bold text-gray-100">ğŸ“‹ ç­†è¨˜ç¸½è¦½</h2>
                    <button id="closeOverviewBtn" class="text-gray-400 hover:text-gray-200 text-2xl leading-none w-8 h-8 flex items-center justify-center hover:bg-gray-700/50 rounded-lg transition-all">
                        Ã—
                    </button>
                </div>

                <!-- Search and Sort Controls -->
                <div class="bg-gray-900/50 border-b border-gray-700/50 p-3 flex-shrink-0">
                    <div class="flex gap-3 items-center mb-2.5">
                        <div class="flex-1 relative">
                            <input
                                id="overviewSearchInput"
                                type="text"
                                placeholder="ğŸ” æœå°‹ç­†è¨˜åç¨±..."
                                class="w-full bg-gray-700/50 text-gray-100 placeholder-gray-400 rounded-lg py-2 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500 border border-gray-600/50 focus:border-blue-500/50 transition-all">
                            <button id="clearOverviewSearchBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200 hidden">
                                âœ•
                            </button>
                        </div>
                        <div class="flex gap-2 items-center">
                            <label class="text-xs text-gray-400 whitespace-nowrap font-medium">æ’åºï¼š</label>
                            <select id="sortSelect" class="bg-gray-700/50 text-gray-100 rounded-lg py-2 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer border border-gray-600/50 transition-all">
                                <option value="updatedAt-desc">æœ€å¾Œæ›´æ–° â†“</option>
                                <option value="updatedAt-asc">æœ€å¾Œæ›´æ–° â†‘</option>
                                <option value="createdAt-desc">å‰µå»ºæ™‚é–“ â†“</option>
                                <option value="createdAt-asc">å‰µå»ºæ™‚é–“ â†‘</option>
                                <option value="title-asc">åç¨± A-Z</option>
                                <option value="title-desc">åç¨± Z-A</option>
                            </select>
                        </div>
                    </div>
                    <!-- Tag Filter -->
                    <div class="flex gap-2 items-center">
                        <label class="text-xs text-gray-400 whitespace-nowrap font-medium">ğŸ·ï¸</label>
                        <select id="tagFilter" class="flex-1 bg-gray-700/50 text-gray-100 rounded-lg py-2 px-3 text-sm outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer border border-gray-600/50 transition-all">
                            <option value="">å…¨éƒ¨æ¨™ç±¤</option>
                            <!-- Tags will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <!-- Stats -->
                <div class="bg-gray-900/30 border-b border-gray-700/50 px-4 py-2 flex justify-between items-center text-xs flex-shrink-0">
                    <span class="text-gray-400">å…± <span id="totalNotesCount" class="text-blue-400 font-semibold">0</span> ç­†ç­†è¨˜</span>
                    <span id="overviewSearchStats" class="text-gray-400 hidden">æ‰¾åˆ° <span id="overviewSearchCount" class="text-green-400 font-semibold">0</span> ç­†çµæœ</span>
                </div>

                <!-- Notes List -->
                <div id="overviewNotesList" class="flex-1 overflow-y-auto p-3">
                    <!-- Notes will be inserted here -->
                </div>

                <!-- Modal Footer -->
                <div class="bg-gradient-to-t from-gray-800 to-gray-800/95 border-t border-gray-700/50 px-4 py-3 flex justify-end flex-shrink-0 rounded-b-xl">
                    <button id="closeOverviewBtn2" class="bg-blue-600 hover:bg-blue-700 text-white py-1.5 px-5 rounded-lg font-medium text-sm transition-all shadow-md hover:shadow-lg">
                        é—œé–‰
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Script started');

        // Configure marked.js for full GFM support
        marked.setOptions({
            gfm: true,              // GitHub Flavored Markdown
            breaks: true,           // Convert \n to <br>
            pedantic: false,
            sanitize: false,        // We use DOMPurify instead
            smartLists: true,
            smartypants: false,
            highlight: function(code, lang) {
                // Use highlight.js for syntax highlighting
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (err) {
                        console.error('Highlight error:', err);
                    }
                }
                return code;
            }
        });

        // Initialize Dexie Database
        const db = new Dexie('MarkdownNotesDB');
        db.version(1).stores({
            notes: 'id, title, content, createdAt, updatedAt'
        });
        db.version(2).stores({
            notes: 'id, title, content, createdAt, updatedAt',
            settings: 'key, value' // ç”¨äºå­˜å‚¨æ–‡ä»¶å¥æŸ„ç­‰è®¾ç½®
        });
        db.version(3).stores({
            notes: 'id, title, content, createdAt, updatedAt, *tags', // *tags è¡¨ç¤º tags æ˜¯å¤šå€¼ç´¢å¼•
            settings: 'key, value'
        });

        // State
        let notes = [];
        let currentNoteId = null;
        let autoSaveTimeout = null;
        let isEditMode = true; // true: ç¼–è¾‘æ¨¡å¼, false: é¢„è§ˆæ¨¡å¼
        let isMarkmapView = false; // true: æ€ç»´å¯¼å›¾è§†å›¾, false: æ­£å¸¸è§†å›¾
        let searchQuery = ''; // æœç´¢å…³é”®å­—
        let markmapInstance = null; // Markmapå®ä¾‹
        const markmapTransformer = typeof markmap !== 'undefined' ? new markmap.Transformer() : null;
        let editorWidth = 50; // ç¼–è¾‘å™¨å®½åº¦ç™¾åˆ†æ¯”ï¼Œé»˜è®¤50%

        // Elements
        const els = {
            newNoteBtn: document.getElementById('newNoteBtn'),
            noteList: document.getElementById('noteList'),
            noteTitle: document.getElementById('noteTitle'),
            noteContent: document.getElementById('noteContent'),
            markdownPreview: document.getElementById('markdownPreview'),
            deleteNoteBtn: document.getElementById('deleteNoteBtn'),
            saveStatus: document.getElementById('saveStatus'),
            toggleModeBtn: document.getElementById('toggleModeBtn'),
            viewModeBtn: document.getElementById('viewModeBtn'),
            editorSection: document.getElementById('editorSection'),
            previewSection: document.getElementById('previewSection'),
            markmapSection: document.getElementById('markmapSection'),
            markmapSvg: document.getElementById('markmapSvg'),
            searchInput: document.getElementById('searchInput'),
            clearSearchBtn: document.getElementById('clearSearchBtn'),
            searchStats: document.getElementById('searchStats'),
            searchCount: document.getElementById('searchCount'),
            noteTimestamp: document.getElementById('noteTimestamp'),
            createdTime: document.getElementById('createdTime'),
            updatedTime: document.getElementById('updatedTime'),
            exportBtn: document.getElementById('exportBtn'),
            importBtn: document.getElementById('importBtn'),
            importFileInput: document.getElementById('importFileInput'),
            helpBtn: document.getElementById('helpBtn'),
            helpModal: document.getElementById('helpModal'),
            closeHelpBtn: document.getElementById('closeHelpBtn'),
            closeHelpBtn2: document.getElementById('closeHelpBtn2'),
            previewFullscreenBtn: document.getElementById('previewFullscreenBtn'),
            markmapFullscreenBtn: document.getElementById('markmapFullscreenBtn'),
            resizeHandle: document.getElementById('resizeHandle'),
            dbStatus: document.getElementById('dbStatus'),
            expandAllBtn: document.getElementById('expandAllBtn'),
            collapseAllBtn: document.getElementById('collapseAllBtn'),
            fitViewBtn: document.getElementById('fitViewBtn'),
            autoBackupBtn: document.getElementById('autoBackupBtn'),
            autoBackupStatus: document.getElementById('autoBackupStatus'),
            overviewBtn: document.getElementById('overviewBtn'),
            overviewModal: document.getElementById('overviewModal'),
            closeOverviewBtn: document.getElementById('closeOverviewBtn'),
            closeOverviewBtn2: document.getElementById('closeOverviewBtn2'),
            overviewNotesList: document.getElementById('overviewNotesList'),
            overviewSearchInput: document.getElementById('overviewSearchInput'),
            clearOverviewSearchBtn: document.getElementById('clearOverviewSearchBtn'),
            sortSelect: document.getElementById('sortSelect'),
            totalNotesCount: document.getElementById('totalNotesCount'),
            overviewSearchStats: document.getElementById('overviewSearchStats'),
            overviewSearchCount: document.getElementById('overviewSearchCount'),
            tagInput: document.getElementById('tagInput'),
            tagsContainer: document.getElementById('tagsContainer'),
            tagFilter: document.getElementById('tagFilter')
        };

        // Dexie Database Functions
        async function loadNotes() {
            try {
                // ä» Dexie åŠ è½½æ‰€æœ‰ç¬”è®°
                notes = await db.notes.orderBy('updatedAt').reverse().toArray();

                // æ›´æ–°æ•°æ®åº“çŠ¶æ€
                els.dbStatus.textContent = `ğŸ’¾ å·²è¼‰å…¥ ${notes.length} ç­†ç­†è¨˜`;
                els.dbStatus.classList.remove('text-gray-400');
                els.dbStatus.classList.add('text-green-400');

                renderNoteList();
                updateTagSuggestions(); // åˆå§‹åŒ–æ ‡ç­¾å»ºè®®

                // æ£€æŸ¥æ˜¯å¦æœ‰ localStorage çš„æ—§æ•°æ®éœ€è¦è¿ç§»
                await migrateFromLocalStorage();
            } catch (err) {
                console.error('è¼‰å…¥ç­†è¨˜å¤±æ•—:', err);
                els.dbStatus.textContent = 'âŒ è¼‰å…¥å¤±æ•—';
                els.dbStatus.classList.add('text-red-400');
                notes = [];
                renderNoteList();
            }
        }

        async function migrateFromLocalStorage() {
            try {
                // æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰æ—§æ•°æ®
                const oldData = localStorage.getItem('demo-notes');
                if (!oldData) return;

                const oldNotes = JSON.parse(oldData);
                if (oldNotes.length === 0) return;

                // æ£€æŸ¥ Dexie ä¸­æ˜¯å¦å·²æœ‰æ•°æ®
                const existingCount = await db.notes.count();
                if (existingCount > 0) {
                    // å¦‚æœå·²æœ‰æ•°æ®ï¼Œè¯¢é—®ç”¨æˆ·
                    const migrate = confirm(
                        `æª¢æ¸¬åˆ° localStorage ä¸­æœ‰ ${oldNotes.length} ç­†èˆŠè³‡æ–™\n` +
                        `ç•¶å‰è³‡æ–™åº«å·²æœ‰ ${existingCount} ç­†è³‡æ–™\n\n` +
                        `æ˜¯å¦è¦åˆä½µèˆŠè³‡æ–™åˆ° IndexedDBï¼Ÿ`
                    );
                    if (!migrate) return;
                }

                // è¿ç§»æ•°æ®åˆ° Dexie
                await db.notes.bulkPut(oldNotes);
                notes = await db.notes.orderBy('updatedAt').reverse().toArray();
                renderNoteList();

                // è¿ç§»æˆåŠŸååˆ é™¤ localStorage æ•°æ®
                localStorage.removeItem('demo-notes');

                alert(`æˆåŠŸé·ç§» ${oldNotes.length} ç­†ç­†è¨˜åˆ° IndexedDBï¼`);
                els.dbStatus.textContent = `ğŸ’¾ å·²è¼‰å…¥ ${notes.length} ç­†ç­†è¨˜`;
            } catch (err) {
                console.error('é·ç§»æ•¸æ“šå¤±æ•—:', err);
                alert('é·ç§»èˆŠè³‡æ–™å¤±æ•—ï¼š' + err.message);
            }
        }

        async function saveNoteToDb(note) {
            try {
                await db.notes.put(note);
                console.log('ç­†è¨˜å·²ä¿å­˜åˆ° IndexedDB:', note.id);
            } catch (err) {
                console.error('å„²å­˜ç­†è¨˜å¤±æ•—:', err);
                // é™çº§åˆ° localStorage
                localStorage.setItem('demo-notes-backup', JSON.stringify(notes));
            }
        }

        async function deleteNoteFromDb(noteId) {
            try {
                await db.notes.delete(noteId);
                console.log('ç­†è¨˜å·²å¾ IndexedDB åˆªé™¤:', noteId);
            } catch (err) {
                console.error('åˆªé™¤ç­†è¨˜å¤±æ•—:', err);
            }
        }

        function renderNoteList() {
            // æœç´¢è¿‡æ»¤
            let filteredNotes = notes;
            if (searchQuery.trim()) {
                const query = searchQuery.toLowerCase();
                filteredNotes = notes.filter(note => {
                    const title = (note.title || '').toLowerCase();
                    const content = (note.content || '').toLowerCase();
                    return title.includes(query) || content.includes(query);
                });

                // æ˜¾ç¤ºæœç´¢ç»Ÿè®¡
                els.searchStats.classList.remove('hidden');
                els.searchCount.textContent = filteredNotes.length;
            } else {
                // éšè—æœç´¢ç»Ÿè®¡
                els.searchStats.classList.add('hidden');
            }

            if (notes.length === 0) {
                els.noteList.innerHTML = '<div class="p-4 text-center text-gray-400"><p>å°šç„¡ç­†è¨˜</p></div>';
                return;
            }

            if (filteredNotes.length === 0) {
                els.noteList.innerHTML = '<div class="p-4 text-center text-gray-400"><p>æ‰¾ä¸åˆ°ç¬¦åˆçš„ç­†è¨˜</p><p class="text-xs mt-2">è©¦è©¦å…¶ä»–é—œéµå­—</p></div>';
                return;
            }

            els.noteList.innerHTML = filteredNotes.map(note => {
                const active = note.id === currentNoteId ? 'active' : '';
                const title = highlightText(note.title || 'ç„¡æ¨™é¡Œ', searchQuery);
                const tags = note.tags || [];
                const tagsHTML = tags.length > 0 ? `
                    <div class="flex flex-wrap gap-1 mt-1.5">
                        ${tags.map(tag => `
                            <span class="inline-block px-2 py-0.5 bg-blue-600/50 text-xs text-blue-200 rounded-full">${escapeHtml(tag)}</span>
                        `).join('')}
                    </div>
                ` : '';

                return `
                    <div class="note-list-item p-3 cursor-pointer border-b border-gray-700 ${active}" onclick="selectNote('${note.id}')">
                        <h3 class="text-sm font-medium text-gray-200 leading-relaxed">${title}</h3>
                        ${tagsHTML}
                    </div>
                `;
            }).join('');
        }

        function highlightText(text, query) {
            if (!query.trim()) {
                return escapeHtml(text);
            }

            const escaped = escapeHtml(text);
            const escapedQuery = escapeHtml(query);
            const regex = new RegExp(`(${escapedQuery})`, 'gi');
            return escaped.replace(regex, '<mark class="bg-yellow-500 text-gray-900 px-1 rounded">$1</mark>');
        }

        function performSearch(query) {
            searchQuery = query;
            renderNoteList();

            // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
            if (query.trim()) {
                els.clearSearchBtn.classList.remove('hidden');
            } else {
                els.clearSearchBtn.classList.add('hidden');
            }
        }

        function clearSearch() {
            els.searchInput.value = '';
            performSearch('');
            els.searchInput.focus();
        }

        async function createNote() {
            console.log('Creating note...');
            const note = {
                id: Date.now().toString(36),
                title: 'æ–°ç­†è¨˜',
                content: '',
                tags: [],
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            // ä¿å­˜åˆ° Dexie
            await saveNoteToDb(note);

            // æ›´æ–°æœ¬åœ°æ•°ç»„
            notes.unshift(note);
            renderNoteList();

            // è§¦å‘è‡ªåŠ¨å¤‡ä»½
            if (autoBackupFileHandle) {
                performAutoBackup().catch(err => console.error('Auto backup failed:', err));
            }

            // æ–°å»ºç¬”è®°æ—¶ç›´æ¥è¿›å…¥ç¼–è¾‘æ¨¡å¼
            currentNoteId = note.id;
            els.noteTitle.value = note.title;
            els.noteContent.value = note.content;
            els.deleteNoteBtn.disabled = false;
            els.toggleModeBtn.disabled = false;
            els.viewModeBtn.disabled = false;
            isMarkmapView = false;
            setEditMode(true);
            renderMarkdown(note.content);
            updateTimestampDisplay(note);

            // æ›´æ–°æ•°æ®åº“çŠ¶æ€
            els.dbStatus.textContent = `ğŸ’¾ å·²è¼‰å…¥ ${notes.length} ç­†ç­†è¨˜`;
        }

        function selectNote(id) {
            console.log('Selecting note:', id);
            const note = notes.find(n => n.id === id);
            if (!note) return;

            currentNoteId = id;
            els.noteTitle.value = note.title;
            els.noteContent.value = note.content;
            els.deleteNoteBtn.disabled = false;
            els.toggleModeBtn.disabled = false;
            els.viewModeBtn.disabled = false;
            isMarkmapView = false;

            // é»˜è®¤è¿›å…¥é¢„è§ˆæ¨¡å¼ï¼ˆMarkdown æ¸²æŸ“æ¨¡å¼ï¼‰
            setEditMode(false);

            renderMarkdown(note.content);
            updateTimestampDisplay(note);
            renderNoteTags(note);
            renderNoteList();
        }

        // Tag Management Functions
        function updateTagSuggestions() {
            // Collect all unique tags from all notes
            const allTags = new Set();
            notes.forEach(note => {
                if (note.tags && Array.isArray(note.tags)) {
                    note.tags.forEach(tag => allTags.add(tag));
                }
            });

            // Sort tags alphabetically (a-z)
            const sortedTags = Array.from(allTags).sort((a, b) => a.localeCompare(b));

            // Update datalist options
            const datalist = document.getElementById('tagSuggestions');
            if (datalist) {
                datalist.innerHTML = sortedTags.map(tag =>
                    `<option value="${escapeHtml(tag)}">`
                ).join('');
            }
        }

        function renderNoteTags(note) {
            if (!note) return;

            // ç¡®ä¿ tags æ•°ç»„å­˜åœ¨
            if (!note.tags) {
                note.tags = [];
            }

            els.tagsContainer.innerHTML = note.tags.map(tag => `
                <span class="inline-flex items-center gap-0.5 px-2 py-0.5 bg-blue-600 text-white text-xs rounded-full">
                    ${escapeHtml(tag)}
                    <button class="hover:text-red-300 font-bold ml-0.5" onclick="removeTag('${escapeHtml(tag)}')" title="åˆªé™¤æ¨™ç±¤">Ã—</button>
                </span>
            `).join('');
        }

        async function addTag(tag) {
            if (!currentNoteId) return;

            const note = notes.find(n => n.id === currentNoteId);
            if (!note) return;

            // æ¸…ç†æ ‡ç­¾
            tag = tag.trim();
            if (!tag) return;

            // ç¡®ä¿ tags æ•°ç»„å­˜åœ¨
            if (!note.tags) {
                note.tags = [];
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (note.tags.includes(tag)) {
                alert('æ­¤æ¨™ç±¤å·²å­˜åœ¨ï¼');
                return;
            }

            // æ·»åŠ æ ‡ç­¾
            note.tags.push(tag);
            note.updatedAt = new Date().toISOString();

            // ä¿å­˜åˆ°æ•°æ®åº“
            await updateNote({ tags: note.tags });

            // é‡æ–°æ¸²æŸ“
            renderNoteTags(note);
            renderNoteList();
            renderOverviewNotesList(); // æ›´æ–°æ€»è§ˆ
            updateTagSuggestions(); // æ›´æ–°æ ‡ç­¾å»ºè®®
        }

        async function removeTag(tag) {
            if (!currentNoteId) return;

            const note = notes.find(n => n.id === currentNoteId);
            if (!note || !note.tags) return;

            // åˆ é™¤æ ‡ç­¾
            note.tags = note.tags.filter(t => t !== tag);
            note.updatedAt = new Date().toISOString();

            // ä¿å­˜åˆ°æ•°æ®åº“
            await updateNote({ tags: note.tags });

            // é‡æ–°æ¸²æŸ“
            renderNoteTags(note);
            renderNoteList();
            updateTagSuggestions(); // æ›´æ–°æ ‡ç­¾å»ºè®®
            renderOverviewNotesList(); // æ›´æ–°æ€»è§ˆ
        }

        // ä½¿ removeTag å‡½æ•°å…¨å±€å¯ç”¨
        window.removeTag = removeTag;

        function setEditMode(editMode) {
            isEditMode = editMode;

            // å¦‚æœä¹‹å‰åœ¨markmapè§†å›¾ï¼Œå…ˆé€€å‡º
            if (isMarkmapView) {
                isMarkmapView = false;
                els.markmapSection.classList.add('hidden');
                els.markmapSection.classList.remove('flex');
                els.viewModeBtn.innerHTML = 'ğŸ—ºï¸ æ€ç¶­å°åœ–';
                els.viewModeBtn.className = 'bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg';
            }

            if (isEditMode) {
                // ç¼–è¾‘æ¨¡å¼ï¼šæ˜¾ç¤ºç¼–è¾‘å™¨å’ŒMarkdowné¢„è§ˆ
                els.editorSection.classList.remove('hidden');
                els.previewSection.classList.remove('hidden');
                els.resizeHandle.style.display = 'block';
                els.noteTitle.disabled = false;
                els.noteContent.disabled = false;
                els.tagInput.disabled = false;
                els.toggleModeBtn.innerHTML = 'âœ… å®Œæˆ';
                els.toggleModeBtn.className = 'bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg';
                els.saveStatus.textContent = 'ç·¨è¼¯æ¨¡å¼';
                applyEditorWidth(); // åº”ç”¨ä¿å­˜çš„å®½åº¦è®¾ç½®
            } else {
                // Markdown é¢„è§ˆæ¨¡å¼ï¼šåªæ˜¾ç¤ºæ¸²æŸ“ç»“æœ
                els.editorSection.classList.add('hidden');
                els.previewSection.classList.remove('hidden');
                els.resizeHandle.style.display = 'none';
                els.noteTitle.disabled = true;
                els.noteContent.disabled = true;
                els.tagInput.disabled = true;
                els.toggleModeBtn.innerHTML = 'âœï¸ ç·¨è¼¯';
                els.toggleModeBtn.className = 'bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg';
                els.saveStatus.textContent = 'Markdown æ¨¡å¼';
                // é¢„è§ˆæ¨¡å¼ä¸‹æ¢å¤ä¸ºflex-1
                els.previewSection.style.flex = '1';
            }
        }

        function toggleMode() {
            if (!currentNoteId) return;
            setEditMode(!isEditMode);
        }

        async function updateNote(data) {
            const note = notes.find(n => n.id === currentNoteId);
            if (!note) return;

            Object.assign(note, data, { updatedAt: new Date().toISOString() });

            // ä¿å­˜åˆ° Dexie
            await saveNoteToDb(note);

            // é‡æ–°æ’åº
            notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            renderNoteList();
            updateTimestampDisplay(note);

            // è§¦å‘è‡ªåŠ¨å¤‡ä»½ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¿å­˜ï¼‰
            if (autoBackupFileHandle) {
                performAutoBackup().catch(err => console.error('Auto backup failed:', err));
            }

            // æ˜¾ç¤ºä¿å­˜çŠ¶æ€
            const originalStatus = els.saveStatus.textContent;
            els.saveStatus.textContent = 'å·²å„²å­˜ âœ“';
            setTimeout(() => {
                els.saveStatus.textContent = isEditMode ? 'ç·¨è¼¯æ¨¡å¼' : 'Markdown æ¨¡å¼';
            }, 2000);
        }

        async function deleteNote() {
            if (!currentNoteId || !confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç­†è¨˜å—ï¼Ÿ')) return;

            // ä» Dexie åˆ é™¤
            await deleteNoteFromDb(currentNoteId);

            // ä»æœ¬åœ°æ•°ç»„åˆ é™¤
            notes = notes.filter(n => n.id !== currentNoteId);

            // è§¦å‘è‡ªåŠ¨å¤‡ä»½
            if (autoBackupFileHandle) {
                performAutoBackup().catch(err => console.error('Auto backup failed:', err));
            }

            currentNoteId = null;
            els.noteTitle.value = '';
            els.noteContent.value = '';
            els.noteTitle.disabled = true;
            els.noteContent.disabled = true;
            els.deleteNoteBtn.disabled = true;
            els.toggleModeBtn.disabled = true;
            els.viewModeBtn.disabled = true;
            els.saveStatus.textContent = 'è«‹é¸æ“‡æˆ–å»ºç«‹ç­†è¨˜';
            els.markdownPreview.innerHTML = '<p class="text-gray-500">Markdown æ¸²æŸ“å€åŸŸ</p>';
            isMarkmapView = false;
            els.markmapSection.classList.add('hidden');
            els.markmapSection.classList.remove('flex');
            updateTimestampDisplay(null);

            renderNoteList();

            // æ›´æ–°æ•°æ®åº“çŠ¶æ€
            els.dbStatus.textContent = `ğŸ’¾ å·²è¼‰å…¥ ${notes.length} ç­†ç­†è¨˜`;
        }

        function renderMarkdown(text) {
            try {
                const html = DOMPurify.sanitize(marked.parse(text || ''));
                els.markdownPreview.innerHTML = html || '<p class="text-gray-500">é è¦½å€åŸŸ</p>';
            } catch (e) {
                console.error('Markdown error:', e);
            }
        }

        function renderMarkmap(text) {
            if (!markmapTransformer || !text) {
                return;
            }

            try {
                const { root } = markmapTransformer.transform(text);

                // ä¼˜åŒ–åçš„é…è‰²æ–¹æ¡ˆ - æ›´é²œè‰³ã€å¯¹æ¯”åº¦æ›´é«˜
                const vibrantColors = [
                    '#3b82f6',  // é²œè‰³è“è‰² - ç¬¬ä¸€å±‚ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰
                    '#10b981',  // ç¿ ç»¿è‰² - ç¬¬äºŒå±‚
                    '#f59e0b',  // é‡‘é»„è‰² - ç¬¬ä¸‰å±‚
                    '#ec4899',  // ç²‰çº¢è‰² - ç¬¬å››å±‚
                    '#8b5cf6',  // ç´«è‰² - ç¬¬äº”å±‚
                    '#06b6d4',  // é’è‰² - ç¬¬å…­å±‚
                    '#f97316',  // æ©™è‰² - ç¬¬ä¸ƒå±‚
                    '#14b8a6'   // è“ç»¿è‰² - ç¬¬å…«å±‚
                ];

                const markmapOptions = {
                    duration: 500,
                    nodeFont: '500 18px "Microsoft JhengHei", "Microsoft YaHei", -apple-system, BlinkMacSystemFont, sans-serif',
                    paddingX: 25,
                    spacingVertical: 25,
                    spacingHorizontal: 130,
                    // èŠ‚ç‚¹é¢œè‰²å‡½æ•°
                    color: (node) => {
                        const depth = node.state?.depth || 0;
                        return vibrantColors[depth % vibrantColors.length];
                    },
                    // è‡ªå®šä¹‰æ ·å¼
                    style: (id) => `
                        #${id} {
                            font-family: "Microsoft JhengHei", "Microsoft YaHei", sans-serif;
                        }
                        /* æ•´ä¸ªèŠ‚ç‚¹ç»„å¯ç‚¹å‡» */
                        #${id} .markmap-node {
                            cursor: pointer !important;
                        }
                        /* å¢å¤§èŠ‚ç‚¹åœ†åœˆ */
                        #${id} .markmap-node > circle {
                            fill: currentColor;
                            stroke: currentColor;
                            stroke-width: 3px;
                            filter: brightness(1.2) drop-shadow(0 0 12px currentColor);
                            r: 10 !important;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        }
                        #${id} .markmap-node:hover > circle {
                            r: 14 !important;
                            filter: brightness(1.5) drop-shadow(0 0 24px currentColor);
                            stroke-width: 5px;
                        }
                        /* å¼ºåŒ–çº¿æ¡å¯è§†æ€§ */
                        #${id} .markmap-link {
                            stroke: currentColor;
                            stroke-width: 4px;
                            opacity: 0.75;
                            transition: all 0.3s ease;
                            filter: drop-shadow(0 0 4px currentColor);
                        }
                        #${id} .markmap-link:hover {
                            stroke-width: 6px;
                            opacity: 1;
                            filter: drop-shadow(0 0 8px currentColor);
                        }
                        /* æ–‡å­—æ ·å¼ */
                        #${id} text {
                            fill: #f3f4f6;
                            font-weight: 500;
                            paint-order: stroke fill;
                            stroke: #000;
                            stroke-width: 3px;
                            stroke-linecap: round;
                            stroke-linejoin: round;
                            cursor: pointer !important;
                            pointer-events: none !important;
                            user-select: none;
                            transition: all 0.2s ease;
                        }
                        /* æ–‡å­—æ‚¬åœæ•ˆæœ */
                        #${id} .markmap-node:hover text {
                            fill: #ffffff;
                            stroke-width: 4px;
                            filter: drop-shadow(0 0 8px currentColor);
                        }
                        /* ä¸ºèŠ‚ç‚¹æ·»åŠ éšå½¢èƒŒæ™¯æ‰©å¤§ç‚¹å‡»åŒºåŸŸ */
                        #${id} .markmap-node foreignObject {
                            cursor: pointer !important;
                            pointer-events: none !important;
                        }
                        #${id} .markmap-node foreignObject > div {
                            cursor: pointer !important;
                            padding: 8px 12px;
                            margin: -8px -12px;
                            border-radius: 6px;
                            transition: all 0.2s ease;
                            pointer-events: none !important;
                        }
                        #${id} .markmap-node:hover foreignObject > div {
                            background-color: rgba(255, 255, 255, 0.1);
                            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
                        }
                        /* ä»£ç æ ·å¼ */
                        #${id} code {
                            background-color: #1e1e1e !important;
                            color: #d4d4d4 !important;
                            padding: 3px 8px !important;
                            border-radius: 4px !important;
                            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
                            font-size: 14px !important;
                            font-weight: 400 !important;
                            border: 1px solid #3a3a3a !important;
                            text-shadow: none !important;
                        }
                        #${id} pre {
                            background-color: #1e1e1e !important;
                            color: #d4d4d4 !important;
                            padding: 12px !important;
                            border-radius: 6px !important;
                            border: 1px solid #3a3a3a !important;
                            margin: 4px 0 !important;
                        }
                        #${id} pre code {
                            background-color: transparent !important;
                            border: none !important;
                            padding: 0 !important;
                        }
                    `
                };

                if (markmapInstance) {
                    markmapInstance.setData(root, markmapOptions);
                } else {
                    markmapInstance = markmap.Markmap.create(els.markmapSvg, markmapOptions, root);
                }

                // è‡ªåŠ¨é€‚é…è§†å›¾å¹¶å¢å¼ºç‚¹å‡»åŒºåŸŸ
                setTimeout(() => {
                    if (markmapInstance && markmapInstance.fit) {
                        markmapInstance.fit();
                    }
                    enhanceNodeClickArea();

                    // ç›‘å¬SVGç‚¹å‡»äº‹ä»¶ï¼Œæ¯æ¬¡ç‚¹å‡»åé‡æ–°å¢å¼ºç‚¹å‡»åŒºåŸŸ
                    els.markmapSvg.addEventListener('click', () => {
                        setTimeout(() => {
                            enhanceNodeClickArea();
                        }, 600); // ç­‰å¾…åŠ¨ç”»å®Œæˆ
                    });
                }, 300);
            } catch (e) {
                console.error('Markmap error:', e);
            }
        }

        // æ·»åŠ èŠ‚ç‚¹ç‚¹å‡»åŒºåŸŸå¢å¼º
        function enhanceNodeClickArea() {
            setTimeout(() => {
                const svg = els.markmapSvg;
                const nodes = svg.querySelectorAll('.markmap-node');

                console.log(`æ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹`);

                nodes.forEach((node, index) => {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»æ·»åŠ äº†ç‚¹å‡»åŒºåŸŸ
                    if (node.querySelector('.click-area')) {
                        console.log(`èŠ‚ç‚¹ ${index} å·²æœ‰ç‚¹å‡»åŒºåŸŸï¼Œè·³è¿‡`);
                        return;
                    }

                    try {
                        // è·å–èŠ‚ç‚¹çš„è¾¹ç•Œæ¡†
                        const bbox = node.getBBox();

                        // åˆ›å»ºä¸€ä¸ªå¤§çš„é€æ˜çŸ©å½¢ä½œä¸ºç‚¹å‡»åŒºåŸŸ
                        const clickArea = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        clickArea.setAttribute('class', 'click-area');
                        clickArea.setAttribute('x', bbox.x - 20);
                        clickArea.setAttribute('y', bbox.y - 15);
                        clickArea.setAttribute('width', bbox.width + 40);
                        clickArea.setAttribute('height', bbox.height + 30);
                        clickArea.setAttribute('fill', 'transparent');
                        clickArea.setAttribute('cursor', 'pointer');
                        clickArea.setAttribute('rx', '8');
                        clickArea.style.pointerEvents = 'all';

                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - æ¨¡æ‹Ÿç‚¹å‡»åœ†åœˆ
                        clickArea.addEventListener('click', (e) => {
                            e.stopPropagation();
                            console.log(`ç‚¹å‡»äº†èŠ‚ç‚¹ ${index}`);

                            // æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„åœ†åœˆå¹¶è§¦å‘ç‚¹å‡»
                            const circle = node.querySelector('circle');
                            if (circle) {
                                console.log('è§¦å‘åœ†åœˆç‚¹å‡»');
                                // åˆ›å»ºä¸€ä¸ªæ–°çš„ç‚¹å‡»äº‹ä»¶
                                const clickEvent = new MouseEvent('click', {
                                    bubbles: true,
                                    cancelable: true,
                                    view: window
                                });
                                circle.dispatchEvent(clickEvent);
                            } else {
                                console.log('æœªæ‰¾åˆ°åœ†åœˆ');
                            }
                        });

                        // æ·»åŠ æ‚¬åœæ•ˆæœ
                        clickArea.addEventListener('mouseenter', () => {
                            clickArea.setAttribute('fill', 'rgba(255, 255, 255, 0.08)');
                            clickArea.setAttribute('stroke', 'rgba(255, 255, 255, 0.2)');
                            clickArea.setAttribute('stroke-width', '2');
                        });
                        clickArea.addEventListener('mouseleave', () => {
                            clickArea.setAttribute('fill', 'transparent');
                            clickArea.removeAttribute('stroke');
                            clickArea.removeAttribute('stroke-width');
                        });

                        // å°†é€æ˜çŸ©å½¢æ’å…¥åˆ°èŠ‚ç‚¹çš„æœ€å‰é¢ï¼ˆä½œä¸ºèƒŒæ™¯ï¼‰
                        node.insertBefore(clickArea, node.firstChild);

                        console.log(`èŠ‚ç‚¹ ${index} æ·»åŠ ç‚¹å‡»åŒºåŸŸæˆåŠŸ`);
                    } catch (e) {
                        console.error(`èŠ‚ç‚¹ ${index} æ·»åŠ ç‚¹å‡»åŒºåŸŸå¤±è´¥:`, e);
                    }
                });
            }, 400);
        }

        // Markmap æ§åˆ¶å‡½æ•°
        function expandAllNodes() {
            if (!markmapInstance) return;

            try {
                // é€’å½’å±•å¼€æ‰€æœ‰èŠ‚ç‚¹
                const expandRecursive = (node) => {
                    if (node.children && node.children.length > 0) {
                        node.payload = node.payload || {};
                        node.payload.fold = 0; // 0 è¡¨ç¤ºå±•å¼€
                        node.children.forEach(child => expandRecursive(child));
                    }
                };

                // è·å–æ ¹èŠ‚ç‚¹å¹¶å±•å¼€æ‰€æœ‰å­èŠ‚ç‚¹
                const state = markmapInstance.state;
                if (state && state.data) {
                    expandRecursive(state.data);
                    markmapInstance.setData(state.data);

                    // å±•å¼€åé€‚é…è§†å›¾å¹¶å¢å¼ºç‚¹å‡»åŒºåŸŸ
                    setTimeout(() => {
                        if (markmapInstance.fit) {
                            markmapInstance.fit();
                        }
                        enhanceNodeClickArea();
                    }, 300);
                }

                console.log('å·²å±•é–‹æ‰€æœ‰ç¯€é»');
            } catch (e) {
                console.error('å±•é–‹ç¯€é»å¤±æ•—:', e);
            }
        }

        function collapseAllNodes() {
            if (!markmapInstance) return;

            try {
                // é€’å½’æŠ˜å æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¿ç•™ç¬¬ä¸€å±‚ï¼‰
                const collapseRecursive = (node, depth = 0) => {
                    if (node.children && node.children.length > 0) {
                        node.payload = node.payload || {};
                        // ç¬¬ä¸€å±‚å±•å¼€ï¼Œå…¶ä»–å±‚æŠ˜å 
                        node.payload.fold = depth >= 1 ? 1 : 0; // 1 è¡¨ç¤ºæŠ˜å 
                        node.children.forEach(child => collapseRecursive(child, depth + 1));
                    }
                };

                // è·å–æ ¹èŠ‚ç‚¹å¹¶æŠ˜å æ‰€æœ‰å­èŠ‚ç‚¹
                const state = markmapInstance.state;
                if (state && state.data) {
                    collapseRecursive(state.data);
                    markmapInstance.setData(state.data);

                    // æŠ˜å åé€‚é…è§†å›¾å¹¶å¢å¼ºç‚¹å‡»åŒºåŸŸ
                    setTimeout(() => {
                        if (markmapInstance.fit) {
                            markmapInstance.fit();
                        }
                        enhanceNodeClickArea();
                    }, 300);
                }

                console.log('å·²æ‘ºç–Šæ‰€æœ‰ç¯€é»');
            } catch (e) {
                console.error('æ‘ºç–Šç¯€é»å¤±æ•—:', e);
            }
        }

        function fitMarkmapView() {
            if (!markmapInstance) return;

            try {
                if (markmapInstance.fit) {
                    markmapInstance.fit();
                    console.log('å·²é©é…è¦–åœ–');
                }
            } catch (e) {
                console.error('é©é…è¦–åœ–å¤±æ•—:', e);
            }
        }

        function toggleViewMode() {
            if (!currentNoteId) return;

            isMarkmapView = !isMarkmapView;

            if (isMarkmapView) {
                // åˆ‡æ¢åˆ°æ€ç»´å¯¼å›¾è§†å›¾
                els.editorSection.classList.add('hidden');
                els.previewSection.classList.add('hidden');
                els.markmapSection.classList.remove('hidden');
                els.markmapSection.classList.add('flex');
                els.viewModeBtn.innerHTML = 'ğŸ“„ è¿”å›é–±è®€';
                els.viewModeBtn.className = 'bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg';

                // æ¸²æŸ“markmap
                const note = notes.find(n => n.id === currentNoteId);
                if (note) {
                    renderMarkmap(note.content);
                }
            } else {
                // è¿”å›æ­£å¸¸è§†å›¾
                els.markmapSection.classList.add('hidden');
                els.markmapSection.classList.remove('flex');

                if (isEditMode) {
                    els.editorSection.classList.remove('hidden');
                    els.previewSection.classList.remove('hidden');
                } else {
                    els.editorSection.classList.add('hidden');
                    els.previewSection.classList.remove('hidden');
                }

                els.viewModeBtn.innerHTML = 'ğŸ—ºï¸ æ€ç¶­å°åœ–';
                els.viewModeBtn.className = 'bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg';
            }
        }

        function debounce(fn, delay) {
            return (...args) => {
                clearTimeout(autoSaveTimeout);
                autoSaveTimeout = setTimeout(() => fn(...args), delay);
            };
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDateTime(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        function formatRelativeTime(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'å‰›å‰›';
            if (diffMins < 60) return `${diffMins} åˆ†é˜å‰`;
            if (diffHours < 24) return `${diffHours} å°æ™‚å‰`;
            if (diffDays < 7) return `${diffDays} å¤©å‰`;

            return formatDateTime(isoString);
        }

        function updateTimestampDisplay(note) {
            if (!note) {
                els.noteTimestamp.classList.add('hidden');
                return;
            }

            els.createdTime.textContent = `å»ºç«‹æ™‚é–“ï¼š${formatDateTime(note.createdAt)}`;
            els.updatedTime.textContent = `æœ€å¾Œæ›´æ–°ï¼š${formatDateTime(note.updatedAt)}`;
            els.noteTimestamp.classList.remove('hidden');
        }

        // Export/Import Functions
        function exportData() {
            try {
                // è·å–æ‰€æœ‰ç¬”è®°æ•°æ®
                const exportData = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    notesCount: notes.length,
                    notes: notes
                };

                // è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
                const jsonString = JSON.stringify(exportData, null, 2);

                // åˆ›å»º Blob å¯¹è±¡
                const blob = new Blob([jsonString], { type: 'application/json' });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;

                // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«æ—¥æœŸæ—¶é—´ï¼‰
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-');
                a.download = `markdown-notes-backup-${dateStr}-${timeStr}.json`;

                // è§¦å‘ä¸‹è½½
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const originalStatus = els.saveStatus.textContent;
                els.saveStatus.textContent = `âœ… å·²åŒ¯å‡º ${notes.length} ç­†ç­†è¨˜`;
                setTimeout(() => {
                    els.saveStatus.textContent = originalStatus;
                }, 3000);

                console.log('Data exported successfully:', exportData);
            } catch (error) {
                console.error('Export error:', error);
                alert('åŒ¯å‡ºå¤±æ•—ï¼š' + error.message);
            }
        }

        function importData() {
            // è§¦å‘æ–‡ä»¶é€‰æ‹©
            els.importFileInput.click();
        }

        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.name.endsWith('.json')) {
                alert('è«‹é¸æ“‡ JSON æ ¼å¼çš„æª”æ¡ˆ');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!importedData.notes || !Array.isArray(importedData.notes)) {
                        throw new Error('ç„¡æ•ˆçš„è³‡æ–™æ ¼å¼ï¼šæ‰¾ä¸åˆ° notes é™£åˆ—');
                    }

                    // è¯¢é—®ç”¨æˆ·å¯¼å…¥æ–¹å¼
                    const choice = confirm(
                        `å³å°‡åŒ¯å…¥ ${importedData.notesCount || importedData.notes.length} ç­†ç­†è¨˜\n\n` +
                        `åŒ¯å‡ºæ—¥æœŸï¼š${importedData.exportDate ? new Date(importedData.exportDate).toLocaleString('zh-TW') : 'æœªçŸ¥'}\n\n` +
                        `é»æ“Šã€Œç¢ºå®šã€å°‡è¦†è“‹ç¾æœ‰è³‡æ–™\n` +
                        `é»æ“Šã€Œå–æ¶ˆã€å°‡åˆä½µè³‡æ–™ï¼ˆä¿ç•™ç¾æœ‰ç­†è¨˜ï¼‰`
                    );

                    let finalNotes = [];
                    let importedCount = 0;

                    if (choice) {
                        // è¦†ç›–æ¨¡å¼ï¼šæ›¿æ¢æ‰€æœ‰æ•°æ®
                        finalNotes = importedData.notes;
                        importedCount = finalNotes.length;
                    } else {
                        // åˆå¹¶æ¨¡å¼ï¼šä¿ç•™ç°æœ‰æ•°æ®ï¼Œæ·»åŠ æ–°æ•°æ®
                        const existingIds = new Set(notes.map(n => n.id));
                        const newNotes = importedData.notes.filter(note => !existingIds.has(note.id));
                        finalNotes = [...notes, ...newNotes];
                        importedCount = newNotes.length;
                    }

                    // æ›´æ–° notes æ•°ç»„
                    notes = finalNotes;

                    // æ’åº
                    notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));

                    // ä¿å­˜åˆ° Dexie
                    if (choice) {
                        // è¦†ç›–æ¨¡å¼ï¼šå…ˆæ¸…ç©ºæ•°æ®åº“ï¼Œå†æ‰¹é‡æ·»åŠ 
                        db.notes.clear().then(() => {
                            return db.notes.bulkPut(notes);
                        }).then(() => {
                            renderNoteList();
                            els.dbStatus.textContent = `ğŸ’¾ å·²è¼‰å…¥ ${notes.length} ç­†ç­†è¨˜`;
                        });
                    } else {
                        // åˆå¹¶æ¨¡å¼ï¼šåªæ·»åŠ æ–°çš„ç¬”è®°
                        const existingIds = new Set(notes.map(n => n.id));
                        const newNotes = importedData.notes.filter(note => !existingIds.has(note.id));
                        db.notes.bulkPut(newNotes).then(() => {
                            renderNoteList();
                            els.dbStatus.textContent = `ğŸ’¾ å·²è¼‰å…¥ ${notes.length} ç­†ç­†è¨˜`;
                        });
                    }

                    renderNoteList();

                    // è§¦å‘è‡ªåŠ¨å¤‡ä»½
                    if (autoBackupFileHandle) {
                        performAutoBackup().catch(err => console.error('Auto backup failed:', err));
                    }

                    // æ¸…é™¤å½“å‰ç¼–è¾‘
                    if (currentNoteId && !notes.find(n => n.id === currentNoteId)) {
                        currentNoteId = null;
                        els.noteTitle.value = '';
                        els.noteContent.value = '';
                        els.noteTitle.disabled = true;
                        els.noteContent.disabled = true;
                        els.deleteNoteBtn.disabled = true;
                        els.toggleModeBtn.disabled = true;
                        els.viewModeBtn.disabled = true;
                        els.markdownPreview.innerHTML = '<p class="text-gray-500">Markdown æ¸²æŸ“å€åŸŸ</p>';
                        isMarkmapView = false;
                        els.markmapSection.classList.add('hidden');
                        updateTimestampDisplay(null);
                    }

                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    const mode = choice ? 'è¦†è“‹' : 'åˆä½µ';
                    els.saveStatus.textContent = `âœ… å·²${mode}åŒ¯å…¥ ${importedCount} ç­†ç­†è¨˜`;
                    setTimeout(() => {
                        els.saveStatus.textContent = 'è«‹é¸æ“‡æˆ–å»ºç«‹ç­†è¨˜';
                    }, 3000);

                    console.log(`Data imported successfully (${mode} mode):`, { importedCount, totalNotes: notes.length });

                } catch (error) {
                    console.error('Import error:', error);
                    alert('åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
                }

                // é‡ç½®æ–‡ä»¶è¾“å…¥
                event.target.value = '';
            };

            reader.onerror = () => {
                alert('è®€å–æª”æ¡ˆå¤±æ•—');
                event.target.value = '';
            };

            reader.readAsText(file);
        }

        // Auto Backup Functions (File System Access API)
        let autoBackupFileHandle = null;

        // æ£€æŸ¥ File System Access API æ”¯æŒ
        function isFileSystemAccessSupported() {
            return 'showSaveFilePicker' in window;
        }

        // è®¾ç½®è‡ªåŠ¨å¤‡ä»½æ–‡ä»¶
        async function setupAutoBackup() {
            if (!isFileSystemAccessSupported()) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´è‡ªå‹•å‚™ä»½åŠŸèƒ½\n\n' +
                      'æ­¤åŠŸèƒ½éœ€è¦ File System Access API æ”¯æ´\n' +
                      'è«‹ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chromeã€Edge æˆ–å…¶ä»–æ”¯æ´çš„ç€è¦½å™¨');
                return;
            }

            try {
                // ç”Ÿæˆé»˜è®¤æ–‡ä»¶å
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const suggestedName = `markdown-notes-auto-backup-${dateStr}.json`;

                // è¯·æ±‚ç”¨æˆ·é€‰æ‹©æˆ–åˆ›å»ºå¤‡ä»½æ–‡ä»¶
                const fileHandle = await window.showSaveFilePicker({
                    suggestedName: suggestedName,
                    types: [{
                        description: 'JSON Files',
                        accept: { 'application/json': ['.json'] }
                    }]
                });

                // ä¿å­˜æ–‡ä»¶å¥æŸ„åˆ° IndexedDB
                await db.settings.put({ key: 'autoBackupFileHandle', value: fileHandle });
                autoBackupFileHandle = fileHandle;

                // ç«‹å³æ‰§è¡Œä¸€æ¬¡å¤‡ä»½
                await performAutoBackup();

                // æ›´æ–°UI
                els.autoBackupStatus.textContent = `ğŸ”„ è‡ªå‹•å‚™ä»½å·²å•Ÿç”¨ â†’ ${fileHandle.name}`;
                els.autoBackupStatus.classList.remove('hidden');
                els.autoBackupStatus.classList.add('text-green-400');
                els.autoBackupBtn.textContent = 'ğŸ’¾ è®Šæ›´å‚™ä»½æª”æ¡ˆ';

                console.log('Auto backup configured:', fileHandle.name);
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('Setup auto backup error:', error);
                    alert('è¨­å®šè‡ªå‹•å‚™ä»½å¤±æ•—ï¼š' + error.message);
                }
            }
        }

        // æ‰§è¡Œè‡ªåŠ¨å¤‡ä»½
        async function performAutoBackup() {
            if (!autoBackupFileHandle) {
                return;
            }

            try {
                // æ£€æŸ¥æƒé™
                const permission = await autoBackupFileHandle.queryPermission({ mode: 'readwrite' });
                if (permission !== 'granted') {
                    const requestPermission = await autoBackupFileHandle.requestPermission({ mode: 'readwrite' });
                    if (requestPermission !== 'granted') {
                        console.warn('Auto backup permission denied');
                        return;
                    }
                }

                // å‡†å¤‡å¤‡ä»½æ•°æ®
                const backupData = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    notesCount: notes.length,
                    notes: notes,
                    autoBackup: true
                };

                // å†™å…¥æ–‡ä»¶
                const writable = await autoBackupFileHandle.createWritable();
                await writable.write(JSON.stringify(backupData, null, 2));
                await writable.close();

                console.log('Auto backup completed:', autoBackupFileHandle.name);

                // æ›´æ–°å¤‡ä»½çŠ¶æ€æ˜¾ç¤º
                const now = new Date();
                const timeStr = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
                els.autoBackupStatus.textContent = `ğŸ”„ æœ€å¾Œå‚™ä»½ï¼š${timeStr} â†’ ${autoBackupFileHandle.name}`;
            } catch (error) {
                console.error('Auto backup error:', error);
                // å¦‚æœå‡ºé”™ï¼Œå¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œæ¸…é™¤ä¿å­˜çš„å¥æŸ„
                if (error.name === 'NotAllowedError') {
                    await db.settings.delete('autoBackupFileHandle');
                    autoBackupFileHandle = null;
                    els.autoBackupStatus.textContent = 'âŒ è‡ªå‹•å‚™ä»½å¤±æ•—ï¼ˆæ¬Šé™ä¸è¶³ï¼‰';
                    els.autoBackupStatus.classList.remove('text-green-400');
                    els.autoBackupStatus.classList.add('text-red-400');
                }
            }
        }

        // åŠ è½½å¹¶åˆå§‹åŒ–è‡ªåŠ¨å¤‡ä»½
        async function initAutoBackup() {
            if (!isFileSystemAccessSupported()) {
                console.log('File System Access API not supported');
                els.autoBackupBtn.disabled = true;
                els.autoBackupBtn.classList.add('opacity-50', 'cursor-not-allowed');
                els.autoBackupBtn.title = 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´æ­¤åŠŸèƒ½';
                return;
            }

            try {
                // ä» IndexedDB åŠ è½½ä¿å­˜çš„æ–‡ä»¶å¥æŸ„
                const setting = await db.settings.get('autoBackupFileHandle');
                if (setting && setting.value) {
                    autoBackupFileHandle = setting.value;

                    // éªŒè¯æ–‡ä»¶å¥æŸ„æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
                    try {
                        const permission = await autoBackupFileHandle.queryPermission({ mode: 'readwrite' });
                        if (permission === 'granted' || permission === 'prompt') {
                            // æ›´æ–°UI
                            els.autoBackupStatus.textContent = `ğŸ”„ è‡ªå‹•å‚™ä»½å·²å•Ÿç”¨ â†’ ${autoBackupFileHandle.name}`;
                            els.autoBackupStatus.classList.remove('hidden');
                            els.autoBackupStatus.classList.add('text-green-400');
                            els.autoBackupBtn.textContent = 'ğŸ’¾ è®Šæ›´å‚™ä»½æª”æ¡ˆ';

                            // æ‰§è¡Œè‡ªåŠ¨å¤‡ä»½
                            await performAutoBackup();
                        }
                    } catch (e) {
                        // æ–‡ä»¶å¥æŸ„æ— æ•ˆï¼Œæ¸…é™¤
                        console.warn('Saved file handle is invalid:', e);
                        await db.settings.delete('autoBackupFileHandle');
                        autoBackupFileHandle = null;
                    }
                }
            } catch (error) {
                console.error('Init auto backup error:', error);
            }
        }

        // Help Modal Functions
        function openHelpModal() {
            els.helpModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
        }

        function closeHelpModal() {
            els.helpModal.classList.add('hidden');
            document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
        }

        // Overview Modal Functions
        let overviewSearchQuery = '';
        let currentSortOption = 'updatedAt-desc';
        let currentTagFilter = '';

        function openOverviewModal() {
            els.overviewModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            populateTagFilter();
            renderOverviewNotesList();
        }

        function populateTagFilter() {
            // æ”¶é›†æ‰€æœ‰æ ‡ç­¾
            const allTags = new Set();
            notes.forEach(note => {
                if (note.tags && Array.isArray(note.tags)) {
                    note.tags.forEach(tag => allTags.add(tag));
                }
            });

            // å¡«å……æ ‡ç­¾é€‰æ‹©å™¨
            const tagsArray = Array.from(allTags).sort();
            els.tagFilter.innerHTML = `
                <option value="">å…¨éƒ¨æ¨™ç±¤${tagsArray.length > 0 ? ` (${tagsArray.length})` : ''}</option>
                ${tagsArray.map(tag => `
                    <option value="${escapeHtml(tag)}">${escapeHtml(tag)}</option>
                `).join('')}
            `;

            // é‡ç½®å½“å‰ç­›é€‰
            els.tagFilter.value = currentTagFilter || '';
        }

        function closeOverviewModal() {
            els.overviewModal.classList.add('hidden');
            document.body.style.overflow = '';
            overviewSearchQuery = '';
            els.overviewSearchInput.value = '';
            els.clearOverviewSearchBtn.classList.add('hidden');
            els.overviewSearchStats.classList.add('hidden');
        }

        function sortNotes(notesList, sortOption) {
            const sorted = [...notesList];
            const [field, order] = sortOption.split('-');

            sorted.sort((a, b) => {
                let valA, valB;

                if (field === 'title') {
                    valA = (a.title || 'ç„¡æ¨™é¡Œ').toLowerCase();
                    valB = (b.title || 'ç„¡æ¨™é¡Œ').toLowerCase();
                } else if (field === 'createdAt') {
                    valA = new Date(a.createdAt);
                    valB = new Date(b.createdAt);
                } else { // updatedAt
                    valA = new Date(a.updatedAt);
                    valB = new Date(b.updatedAt);
                }

                if (order === 'asc') {
                    return valA > valB ? 1 : valA < valB ? -1 : 0;
                } else {
                    return valA < valB ? 1 : valA > valB ? -1 : 0;
                }
            });

            return sorted;
        }

        function filterOverviewNotes(notesList, query) {
            let filtered = notesList;

            // æŒ‰æœç´¢å…³é”®å­—è¿‡æ»¤
            if (query.trim()) {
                const lowerQuery = query.toLowerCase();
                filtered = filtered.filter(note => {
                    const title = (note.title || 'ç„¡æ¨™é¡Œ').toLowerCase();
                    return title.includes(lowerQuery);
                });
            }

            // æŒ‰æ ‡ç­¾è¿‡æ»¤
            if (currentTagFilter) {
                filtered = filtered.filter(note => {
                    return note.tags && note.tags.includes(currentTagFilter);
                });
            }

            return filtered;
        }

        function highlightText(text, query) {
            if (!query.trim()) return text;

            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark class="bg-yellow-400 text-black">$1</mark>');
        }

        function renderOverviewNotesList() {
            // Filter notes
            let filteredNotes = filterOverviewNotes(notes, overviewSearchQuery);

            // Sort notes
            const sortedNotes = sortNotes(filteredNotes, currentSortOption);

            // Update stats
            els.totalNotesCount.textContent = notes.length;

            if (overviewSearchQuery.trim()) {
                els.overviewSearchStats.classList.remove('hidden');
                els.overviewSearchCount.textContent = filteredNotes.length;
            } else {
                els.overviewSearchStats.classList.add('hidden');
            }

            // Render notes list
            if (sortedNotes.length === 0) {
                els.overviewNotesList.innerHTML = `
                    <div class="text-center text-gray-500 py-12">
                        <p class="text-lg">ğŸ“</p>
                        <p class="mt-2">${overviewSearchQuery.trim() ? 'æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„ç­†è¨˜' : 'å°šç„¡ç­†è¨˜'}</p>
                    </div>
                `;
                return;
            }

            const notesHTML = sortedNotes.map(note => {
                const title = note.title || 'ç„¡æ¨™é¡Œ';
                const highlightedTitle = highlightText(title, overviewSearchQuery);
                const createdDate = new Date(note.createdAt).toLocaleDateString('zh-TW');
                const updatedDate = new Date(note.updatedAt).toLocaleDateString('zh-TW');
                const isCurrentNote = note.id === currentNoteId;
                const tags = note.tags || [];
                const tagsHTML = tags.length > 0 ? `
                    <div class="flex flex-wrap gap-1 mt-1">
                        ${tags.map(tag => `
                            <span class="inline-block px-1.5 py-0.5 bg-blue-600 text-[10px] text-white rounded-full">
                                ${escapeHtml(tag)}
                            </span>
                        `).join('')}
                    </div>
                ` : '';

                return `
                    <div class="bg-gray-700 rounded-lg p-2.5 mb-2 transition-colors ${isCurrentNote ? 'ring-2 ring-blue-500' : ''} group">
                        <div class="flex justify-between items-start gap-2">
                            <div class="flex-1 min-w-0">
                                <div class="flex flex-wrap items-baseline gap-x-2 gap-y-1 mb-1">
                                    <h3 class="text-base font-semibold text-gray-100 cursor-pointer hover:text-blue-400 transition-colors group-hover:underline"
                                        data-note-id="${note.id}"
                                        title="é»æ“Šé–‹å•Ÿç­†è¨˜">
                                        ${highlightedTitle}
                                    </h3>
                                    <div class="flex flex-wrap items-center gap-x-2 gap-y-0.5 text-xs text-gray-400">
                                        <span class="whitespace-nowrap">å‰µå»º ${createdDate}</span>
                                        <span class="whitespace-nowrap">æ›´æ–° ${updatedDate}</span>
                                    </div>
                                </div>
                                ${tagsHTML}
                            </div>
                            ${isCurrentNote ? '<div class="text-blue-400 text-xs font-semibold whitespace-nowrap">âœ“ ç•¶å‰</div>' : ''}
                        </div>
                    </div>
                `;
            }).join('');

            els.overviewNotesList.innerHTML = notesHTML;

            // Add click event listeners to note titles
            els.overviewNotesList.querySelectorAll('h3[data-note-id]').forEach(titleEl => {
                titleEl.addEventListener('click', (e) => {
                    e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
                    const noteId = titleEl.dataset.noteId;
                    selectNote(noteId);
                    closeOverviewModal();
                });
            });
        }

        function performOverviewSearch(query) {
            overviewSearchQuery = query;

            if (query.trim()) {
                els.clearOverviewSearchBtn.classList.remove('hidden');
            } else {
                els.clearOverviewSearchBtn.classList.add('hidden');
            }

            renderOverviewNotesList();
        }

        function clearOverviewSearch() {
            els.overviewSearchInput.value = '';
            overviewSearchQuery = '';
            els.clearOverviewSearchBtn.classList.add('hidden');
            renderOverviewNotesList();
        }

        // Fullscreen Functions
        function toggleFullscreen(section, btn) {
            const isFullscreen = section.classList.contains('fullscreen-mode');

            if (isFullscreen) {
                // é€€å‡ºå…¨å±
                section.classList.remove('fullscreen-mode');
                btn.innerHTML = 'â›¶';
                btn.title = 'å…¨å±æŸ¥çœ‹';
                document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨

                // å¦‚æœæ˜¯æ€ç»´å¯¼å›¾ï¼Œéœ€è¦é‡æ–°é€‚é…è§†å›¾
                if (section === els.markmapSection && markmapInstance) {
                    setTimeout(() => {
                        if (markmapInstance && markmapInstance.fit) {
                            markmapInstance.fit();
                        }
                    }, 150);
                }
            } else {
                // è¿›å…¥å…¨å±
                section.classList.add('fullscreen-mode');
                btn.innerHTML = 'â›‰';
                btn.title = 'é€€å‡ºå…¨å± (ESC)';
                document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨

                // å¦‚æœæ˜¯æ€ç»´å¯¼å›¾ï¼Œéœ€è¦é‡æ–°é€‚é…è§†å›¾
                if (section === els.markmapSection && markmapInstance) {
                    setTimeout(() => {
                        if (markmapInstance && markmapInstance.fit) {
                            markmapInstance.fit();
                        }
                    }, 150);
                }
            }
        }

        function exitAllFullscreen() {
            // é€€å‡ºæ‰€æœ‰å…¨å±
            if (els.previewSection.classList.contains('fullscreen-mode')) {
                toggleFullscreen(els.previewSection, els.previewFullscreenBtn);
            }
            if (els.markmapSection.classList.contains('fullscreen-mode')) {
                toggleFullscreen(els.markmapSection, els.markmapFullscreenBtn);
            }
        }

        // Resize Handle Functions
        function loadEditorWidth() {
            const saved = localStorage.getItem('editor-width');
            if (saved) {
                editorWidth = parseFloat(saved);
                applyEditorWidth();
            }
        }

        function saveEditorWidth() {
            localStorage.setItem('editor-width', editorWidth.toString());
        }

        function applyEditorWidth() {
            // ç¡®ä¿å®½åº¦åœ¨åˆç†èŒƒå›´å†… (20% - 80%)
            editorWidth = Math.max(20, Math.min(80, editorWidth));

            els.editorSection.style.flex = `0 0 ${editorWidth}%`;
            els.previewSection.style.flex = `0 0 ${100 - editorWidth}%`;
        }

        function initResizeHandle() {
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            els.resizeHandle.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = editorWidth;
                document.body.classList.add('resizing');
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                const container = els.editorSection.parentElement;
                const containerWidth = container.offsetWidth;
                const deltaX = e.clientX - startX;
                const deltaPercent = (deltaX / containerWidth) * 100;

                editorWidth = startWidth + deltaPercent;
                applyEditorWidth();
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.classList.remove('resizing');
                    saveEditorWidth();
                }
            });

            // åŒå‡»é‡ç½®ä¸º50/50
            els.resizeHandle.addEventListener('dblclick', () => {
                editorWidth = 50;
                applyEditorWidth();
                saveEditorWidth();
            });
        }

        // Make selectNote global
        window.selectNote = selectNote;

        // Event listeners
        els.newNoteBtn.addEventListener('click', createNote);
        els.deleteNoteBtn.addEventListener('click', deleteNote);
        els.toggleModeBtn.addEventListener('click', toggleMode);
        els.viewModeBtn.addEventListener('click', toggleViewMode);

        // Export/Import events
        els.exportBtn.addEventListener('click', exportData);
        els.importBtn.addEventListener('click', importData);
        els.importFileInput.addEventListener('change', handleImportFile);

        // Auto Backup events
        els.autoBackupBtn.addEventListener('click', setupAutoBackup);

        // Help Modal events
        els.helpBtn.addEventListener('click', openHelpModal);
        els.closeHelpBtn.addEventListener('click', closeHelpModal);
        els.closeHelpBtn2.addEventListener('click', closeHelpModal);

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        els.helpModal.addEventListener('click', (e) => {
            if (e.target === els.helpModal) {
                closeHelpModal();
            }
        });

        // Overview Modal events
        els.overviewBtn.addEventListener('click', openOverviewModal);
        els.closeOverviewBtn.addEventListener('click', closeOverviewModal);
        els.closeOverviewBtn2.addEventListener('click', closeOverviewModal);

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        els.overviewModal.addEventListener('click', (e) => {
            if (e.target === els.overviewModal) {
                closeOverviewModal();
            }
        });

        // Overview search and sort
        els.overviewSearchInput.addEventListener('input', (e) => {
            performOverviewSearch(e.target.value);
        });

        els.clearOverviewSearchBtn.addEventListener('click', clearOverviewSearch);

        els.sortSelect.addEventListener('change', (e) => {
            currentSortOption = e.target.value;
            renderOverviewNotesList();
        });

        els.tagFilter.addEventListener('change', (e) => {
            currentTagFilter = e.target.value;
            renderOverviewNotesList();
        });

        // Fullscreen events
        els.previewFullscreenBtn.addEventListener('click', () => {
            toggleFullscreen(els.previewSection, els.previewFullscreenBtn);
        });

        els.markmapFullscreenBtn.addEventListener('click', () => {
            toggleFullscreen(els.markmapSection, els.markmapFullscreenBtn);
        });

        // Markmap æ§åˆ¶æŒ‰é’®äº‹ä»¶
        els.expandAllBtn.addEventListener('click', expandAllNodes);
        els.collapseAllBtn.addEventListener('click', collapseAllNodes);
        els.fitViewBtn.addEventListener('click', fitMarkmapView);

        // ESC é”®å…³é—­æ¨¡æ€æ¡†æˆ–é€€å‡ºå…¨å±
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // ä¼˜å…ˆå…³é—­å¸®åŠ©æ¨¡æ€æ¡†
                if (!els.helpModal.classList.contains('hidden')) {
                    closeHelpModal();
                }
                // ç„¶åå…³é—­æ€»è§ˆæ¨¡æ€æ¡†
                else if (!els.overviewModal.classList.contains('hidden')) {
                    closeOverviewModal();
                }
                // ç„¶åé€€å‡ºå…¨å±
                else if (els.previewSection.classList.contains('fullscreen-mode') ||
                         els.markmapSection.classList.contains('fullscreen-mode')) {
                    exitAllFullscreen();
                }
                // æœ€åæ¸…é™¤æœç´¢
                else if (els.searchInput.value) {
                    clearSearch();
                }
            }
        });

        // Search events
        els.searchInput.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });

        els.clearSearchBtn.addEventListener('click', clearSearch);

        const debouncedSave = debounce((data) => updateNote(data), 1500);

        els.noteTitle.addEventListener('input', (e) => {
            debouncedSave({ title: e.target.value });
            renderNoteList();
        });

        els.noteContent.addEventListener('input', (e) => {
            debouncedSave({ content: e.target.value });
            renderMarkdown(e.target.value);
        });

        // Tag input events
        els.tagInput.addEventListener('focus', () => {
            updateTagSuggestions(); // èšç„¦æ—¶æ›´æ–°æ ‡ç­¾å»ºè®®
        });

        els.tagInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tag = els.tagInput.value.trim();
                if (tag) {
                    await addTag(tag);
                    els.tagInput.value = '';
                }
            }
        });

        // Initialize
        (async () => {
            await loadNotes();
            loadEditorWidth();
            initResizeHandle();
            await initAutoBackup(); // åˆå§‹åŒ–è‡ªåŠ¨å¤‡ä»½ï¼ˆå¦‚æœå·²è®¾ç½®ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ï¼‰
            console.log('App ready!');
        })();
    </script>
</body>
</html>
