<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Note Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Markmap Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-lib"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>
    <style>
        /* çº¯é»‘è‰²èƒŒæ™¯ä¸»é¢˜ */
        body { background-color: #000000 !important; }
        .bg-gray-900 { background-color: #000000 !important; }
        .bg-gray-800 { background-color: #0a0a0a !important; }
        .bg-gray-700 { background-color: #1a1a1a !important; }
        .border-gray-700 { border-color: #2a2a2a !important; }
        .border-gray-600 { border-color: #333333 !important; }

        .note-list-item { transition: background-color 0.2s; }
        .note-list-item:hover { background-color: rgba(59, 130, 246, 0.25); }
        .note-list-item.active { background-color: rgba(59, 130, 246, 0.35); border-left: 4px solid #3b82f6; }
        .markdown-preview {
            line-height: 1.6;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 'Microsoft YaHei', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .markdown-preview h1 { font-size: 2em; font-weight: 800; margin: 0.67em 0; color: #ffffff; border-bottom: 2px solid #2a2a2a; padding-bottom: 0.3em; }
        .markdown-preview h2 { font-size: 1.5em; font-weight: 800; margin: 0.83em 0; color: #ffffff; border-bottom: 1px solid #2a2a2a; padding-bottom: 0.3em; }
        .markdown-preview h3 { font-size: 1.17em; font-weight: 800; margin: 1em 0; color: #ffffff; }
        .markdown-preview h4 { font-size: 1em; font-weight: 700; margin: 1em 0; color: #f3f4f6; }
        .markdown-preview h5 { font-size: 0.875em; font-weight: 700; margin: 1em 0; color: #f3f4f6; }
        .markdown-preview h6 { font-size: 0.85em; font-weight: 700; margin: 1em 0; color: #e5e7eb; }
        .markdown-preview p { margin-bottom: 1em; }
        .markdown-preview ul { list-style-type: disc; margin-left: 2em; margin-bottom: 1em; padding-left: 0; }
        .markdown-preview ol { list-style-type: decimal; margin-left: 2em; margin-bottom: 1em; padding-left: 0; }
        .markdown-preview li { margin-left: 1em; margin-bottom: 0.5em; }
        .markdown-preview code { background-color: #1a1a1a; color: #e5e7eb; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; border: 1px solid #2a2a2a; }
        .markdown-preview pre { background-color: #0a0a0a; padding: 1em; border-radius: 5px; overflow-x: auto; margin-bottom: 1em; border: 1px solid #2a2a2a; }
        .markdown-preview pre code { background-color: transparent; padding: 0; border: none; }
        .markdown-preview blockquote { border-left: 4px solid #3b82f6; padding-left: 1em; margin: 0 0 1em 0; color: #9ca3af; background-color: #0a0a0a; padding: 1em; border-radius: 3px; }
        .markdown-preview table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
        .markdown-preview table th { background-color: #1a1a1a; color: #ffffff; font-weight: bold; padding: 0.75em; text-align: left; border: 1px solid #2a2a2a; }
        .markdown-preview table td { padding: 0.75em; border: 1px solid #2a2a2a; }
        .markdown-preview table tr:nth-child(even) { background-color: #0a0a0a; }
        .markdown-preview table tr:hover { background-color: rgba(59, 130, 246, 0.15); }
        .markdown-preview a { color: #60a5fa; text-decoration: underline; }
        .markdown-preview a:hover { color: #93c5fd; }
        .markdown-preview hr { border: none; border-top: 1px solid #4b5563; margin: 1.5em 0; }
        .markdown-preview img { max-width: 100%; height: auto; border-radius: 5px; margin: 1em 0; }
        .markdown-preview del { text-decoration: line-through; opacity: 0.7; }
        .markdown-preview strong {
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 0 1px rgba(255, 255, 255, 0.5);
            letter-spacing: 0.01em;
        }
        .markdown-preview em { font-style: italic; color: #e5e7eb; }
        .markdown-preview strong em, .markdown-preview em strong {
            font-weight: 900;
            font-style: italic;
            color: #ffffff;
            text-shadow: 0 0 1px rgba(255, 255, 255, 0.5);
        }
        .markdown-preview ul.contains-task-list { list-style: none !important; margin-left: 1em; padding-left: 0; }
        .markdown-preview ul.contains-task-list li { margin-left: 0; }
        .markdown-preview input[type="checkbox"] { margin-right: 0.5em; cursor: pointer; }
        .markdown-preview input[type="checkbox"]:disabled { cursor: default; }
        .markdown-preview sup { vertical-align: super; font-size: smaller; }
        .markdown-preview sub { vertical-align: sub; font-size: smaller; }
        #noteTitle:disabled { opacity: 1; cursor: default; }

        /* Markmapå®¹å™¨æ ·å¼ */
        #markmapSection {
            flex: 1;
            background: radial-gradient(circle at center, #0a0a0a 0%, #000000 100%);
            overflow: hidden;
            position: relative;
        }

        /* æ·»åŠ ç½‘æ ¼èƒŒæ™¯æ•ˆæœ */
        #markmapSection::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                linear-gradient(90deg, rgba(96, 165, 250, 0.05) 1px, transparent 1px),
                linear-gradient(rgba(96, 165, 250, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            opacity: 0.3;
            z-index: 0;
        }

        #markmapSection svg {
            width: 100%;
            height: 100%;
            display: block;
            position: relative;
            z-index: 1;
        }

        /* Markmapæ–‡å­—æ ·å¼ - æ›´å¤§æ›´æ¸…æ™° */
        #markmapSection svg text,
        #markmapSection svg tspan {
            fill: #f3f4f6 !important;
            font-size: 18px !important;
            font-weight: 500 !important;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8), 0 0 3px rgba(0, 0, 0, 0.9) !important;
        }

        #markmapSection svg strong,
        #markmapSection svg b {
            fill: #ffffff !important;
            font-weight: 800 !important;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3) !important;
        }

        /* ä¼˜åŒ–è¿æ¥çº¿ */
        #markmapSection svg path.markmap-link {
            stroke-width: 2.5px !important;
            opacity: 0.6 !important;
        }

        /* ä¼˜åŒ–èŠ‚ç‚¹åœ†åœˆ */
        #markmapSection svg circle {
            stroke-width: 3px !important;
            filter: drop-shadow(0 0 8px currentColor) brightness(1.2) !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
        }

        #markmapSection svg circle:hover {
            filter: drop-shadow(0 0 12px currentColor) brightness(1.4) !important;
            transform: scale(1.1) !important;
        }

        /* ä¼˜åŒ–æ–‡å­—æè¾¹æ•ˆæœ */
        #markmapSection svg foreignObject {
            overflow: visible !important;
        }

        #markmapSection svg foreignObject div {
            color: #f3f4f6 !important;
            text-shadow:
                -1px -1px 0 #000,
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000,
                0 0 8px rgba(0, 0, 0, 0.9),
                0 0 4px rgba(0, 0, 0, 0.8) !important;
            font-weight: 500 !important;
        }

        /* æ ¹èŠ‚ç‚¹ç‰¹æ®Šæ ·å¼ */
        #markmapSection svg > g > g:first-child circle {
            stroke-width: 4px !important;
            filter: drop-shadow(0 0 12px currentColor) brightness(1.3) !important;
        }

        #markmapSection svg > g > g:first-child text {
            font-size: 20px !important;
            font-weight: 700 !important;
        }

        /* ä»£ç åŒºå—æ ·å¼ä¼˜åŒ– - æ·±ç°èƒŒæ™¯ */
        #markmapSection svg code,
        #markmapSection svg foreignObject code {
            background-color: #1e1e1e !important;
            color: #d4d4d4 !important;
            padding: 3px 8px !important;
            border-radius: 4px !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
            font-size: 14px !important;
            font-weight: 400 !important;
            border: 1px solid #3a3a3a !important;
            text-shadow: none !important;
        }

        #markmapSection svg pre,
        #markmapSection svg foreignObject pre {
            background-color: #1e1e1e !important;
            color: #d4d4d4 !important;
            padding: 12px !important;
            border-radius: 6px !important;
            border: 1px solid #3a3a3a !important;
            margin: 4px 0 !important;
        }

        #markmapSection svg pre code,
        #markmapSection svg foreignObject pre code {
            background-color: transparent !important;
            border: none !important;
            padding: 0 !important;
        }

        /* ç¡®ä¿ä»£ç åŒºå—å†…çš„æ–‡å­—ä¸ç»§æ‰¿æè¾¹æ•ˆæœ */
        #markmapSection svg code *,
        #markmapSection svg pre *,
        #markmapSection svg foreignObject code *,
        #markmapSection svg foreignObject pre * {
            text-shadow: none !important;
            stroke: none !important;
            font-weight: 400 !important;
        }

        /* è¡Œå†…ä»£ç æ ·å¼ */
        #markmapSection svg foreignObject div code {
            background-color: #1e1e1e !important;
            color: #d4d4d4 !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            font-size: 13px !important;
            font-weight: 400 !important;
            border: 1px solid #3a3a3a !important;
        }

        /* å…¨å±æ¨¡å¼æ ·å¼ */
        .fullscreen-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            background-color: #000000 !important;
            flex: none !important;
        }

        .fullscreen-mode .fullscreen-content {
            width: 100% !important;
            height: calc(100% - 48px) !important;
        }

        /* å…¨å±æ—¶çš„æ ‡é¢˜æ  */
        .fullscreen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: #0a0a0a;
            border-bottom: 1px solid #2a2a2a;
        }

        /* å…¨å±æŒ‰é’®æ ·å¼ */
        .fullscreen-btn {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .fullscreen-btn:hover {
            background-color: rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900">
    <div class="h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gray-800 text-white p-4 shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">ğŸ“ Markdown Note Cloud</h1>
                <div class="flex items-center gap-3">
                    <button id="helpBtn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm font-semibold">
                        â“ ä½¿ç”¨èªªæ˜
                    </button>
                    <span class="text-sm text-gray-300">æœ¬åœ°å„²å­˜æ¨¡å¼</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-80 bg-gray-800 border-r border-gray-700 flex flex-col">
                <div class="p-4 border-b border-gray-700">
                    <button id="newNoteBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg mb-2">
                        â• æ–°å¢ç­†è¨˜
                    </button>
                    <div class="flex gap-2">
                        <button id="exportBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg text-sm">
                            ğŸ“¤ åŒ¯å‡º
                        </button>
                        <button id="importBtn" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-3 rounded-lg text-sm">
                            ğŸ“¥ åŒ¯å…¥
                        </button>
                    </div>
                    <input type="file" id="importFileInput" accept=".json" class="hidden">
                </div>
                <div class="p-4 border-b border-gray-700">
                    <div class="relative">
                        <input
                            id="searchInput"
                            type="text"
                            placeholder="ğŸ” æœå°‹ç­†è¨˜..."
                            class="w-full bg-gray-700 text-gray-100 placeholder-gray-400 rounded-lg py-2 px-4 outline-none focus:ring-2 focus:ring-blue-500">
                        <button id="clearSearchBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200 hidden">
                            âœ•
                        </button>
                    </div>
                    <div id="searchStats" class="mt-2 text-xs text-gray-400 hidden">
                        æ‰¾åˆ° <span id="searchCount">0</span> ç­†çµæœ
                    </div>
                </div>
                <div id="noteList" class="flex-1 overflow-y-auto"></div>
            </aside>

            <!-- Editor -->
            <main class="flex-1 flex flex-col bg-gray-800">
                <div class="p-4 border-b border-gray-700">
                    <input id="noteTitle" type="text" placeholder="è¼¸å…¥ç­†è¨˜æ¨™é¡Œ..."
                           class="w-full text-2xl font-bold outline-none bg-transparent text-gray-100 placeholder-gray-500" disabled>
                    <div id="noteTimestamp" class="mt-2 text-xs text-gray-500 hidden">
                        <span id="createdTime"></span>
                        <span class="mx-2">â€¢</span>
                        <span id="updatedTime"></span>
                    </div>
                </div>
                <div class="flex-1 flex overflow-hidden">
                    <div id="editorSection" class="flex-1 flex flex-col border-r border-gray-700">
                        <div class="p-2 bg-gray-900 border-b border-gray-700">
                            <span class="text-sm font-semibold text-gray-300">âœï¸ ç·¨è¼¯å™¨</span>
                        </div>
                        <textarea id="noteContent" placeholder="åœ¨æ­¤è¼¸å…¥ Markdown å…§å®¹..."
                                  class="flex-1 p-4 outline-none resize-none font-mono text-sm bg-gray-800 text-gray-100 placeholder-gray-500" disabled></textarea>
                    </div>
                    <div id="previewSection" class="flex-1 flex flex-col">
                        <div class="p-2 bg-gray-900 border-b border-gray-700 flex justify-between items-center">
                            <span class="text-sm font-semibold text-gray-300">ğŸ“„ Markdown</span>
                            <button id="previewFullscreenBtn" class="fullscreen-btn text-gray-400 hover:text-gray-200 text-lg" title="å…¨å±æŸ¥çœ‹">
                                â›¶
                            </button>
                        </div>
                        <div id="markdownPreview" class="fullscreen-content flex-1 p-4 overflow-y-auto markdown-preview text-gray-100">
                            <p class="text-gray-500">Markdown æ¸²æŸ“å€åŸŸ</p>
                        </div>
                    </div>
                    <div id="markmapSection" class="hidden flex-1 flex-col">
                        <div class="p-2 bg-gray-900 border-b border-gray-700 flex justify-between items-center">
                            <span class="text-sm font-semibold text-gray-300">ğŸ—ºï¸ æ€ç¶­å°åœ–</span>
                            <button id="markmapFullscreenBtn" class="fullscreen-btn text-gray-400 hover:text-gray-200 text-lg" title="å…¨å±æŸ¥çœ‹">
                                â›¶
                            </button>
                        </div>
                        <div id="markmapContainer" class="fullscreen-content flex-1">
                            <svg id="markmapSvg"></svg>
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t border-gray-700 flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <span id="saveStatus" class="text-sm text-gray-400">è«‹é¸æ“‡æˆ–å»ºç«‹ç­†è¨˜</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button id="viewModeBtn" class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>
                            ğŸ—ºï¸ æ€ç¶­å°åœ–
                        </button>
                        <button id="toggleModeBtn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>
                            âœï¸ ç·¨è¼¯
                        </button>
                        <button id="deleteNoteBtn" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>
                            ğŸ—‘ï¸ åˆªé™¤ç­†è¨˜
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
                <!-- Modal Header -->
                <div class="sticky top-0 bg-gray-800 border-b border-gray-700 p-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-100">ğŸ“– ä½¿ç”¨èªªæ˜</h2>
                    <button id="closeHelpBtn" class="text-gray-400 hover:text-gray-200 text-3xl leading-none">
                        Ã—
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="p-6 text-gray-200 space-y-6">
                    <!-- åŠŸèƒ½ä»‹ç´¹ -->
                    <section>
                        <h3 class="text-xl font-bold text-blue-400 mb-3">âœ¨ åŠŸèƒ½ç‰¹è‰²</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-300">
                            <li>ğŸ“„ æ”¯æ´å®Œæ•´ GitHub Flavored Markdown (GFM) èªæ³•</li>
                            <li>ğŸ—ºï¸ æ€ç¶­å°åœ–è¦–åœ–ï¼šå°‡ç­†è¨˜è½‰æ›ç‚ºäº’å‹•å¼å¿ƒæ™ºåœ–</li>
                            <li>â›¶ å…¨å±æ¨¡å¼ï¼šMarkdown èˆ‡æ€ç¶­å°åœ–å¯åˆ‡æ›ç‚ºå…¨ç€è¦½å™¨ç¯„åœæŸ¥çœ‹</li>
                            <li>ğŸ¨ ç¨‹å¼ç¢¼èªæ³•é«˜äº®ï¼šæ”¯æ´ 180+ ç¨®ç¨‹å¼èªè¨€</li>
                            <li>âœ… æ”¯æ´ä»»å‹™åˆ—è¡¨ã€è¡¨æ ¼ã€åˆªé™¤ç·šç­‰ GFM æ“´å±•èªæ³•</li>
                            <li>âœï¸ ä¸‰ç¨®è¦–åœ–æ¨¡å¼ï¼šé–±è®€ / ç·¨è¼¯ / æ€ç¶­å°åœ–</li>
                            <li>ğŸ” å…¨æ–‡æª¢ç´¢ï¼šå³æ™‚æœå°‹æ¨™é¡Œå’Œå…§å®¹ï¼Œé—œéµå­—é«˜äº®é¡¯ç¤º</li>
                            <li>ğŸ“¤ğŸ“¥ è³‡æ–™åŒ¯å‡º/åŒ¯å…¥ï¼šæ”¯æ´å‚™ä»½å’Œé‚„åŸæ‰€æœ‰ç­†è¨˜</li>
                            <li>ğŸ“… æ™‚é–“æ¨™è¨˜ï¼šè‡ªå‹•è¨˜éŒ„å»ºç«‹æ™‚é–“èˆ‡æœ€å¾Œæ›´æ–°æ™‚é–“</li>
                            <li>ğŸ’¾ è‡ªå‹•å„²å­˜ï¼šç·¨è¼¯å¾Œ 1.5 ç§’è‡ªå‹•å„²å­˜</li>
                            <li>ğŸŒ“ ç´”é»‘æ·±è‰²æ¨¡å¼ï¼šOLED å‹å–„çš„ç´”é»‘ç•Œé¢</li>
                            <li>ğŸ” å®‰å…¨ä¿è­·ï¼šé˜²æ­¢ XSS æ”»æ“Š</li>
                        </ul>
                    </section>

                    <!-- åŸºæœ¬æ“ä½œ -->
                    <section>
                        <h3 class="text-xl font-bold text-green-400 mb-3">ğŸ“ åŸºæœ¬æ“ä½œ</h3>

                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">1ï¸âƒ£ å»ºç«‹ç­†è¨˜</h4>
                                <p class="text-gray-300 ml-4">é»æ“Šå·¦å´é¢æ¿çš„ã€Œâ• æ–°å¢ç­†è¨˜ã€æŒ‰éˆ•ï¼Œç³»çµ±æœƒè‡ªå‹•å»ºç«‹ä¸€ç¯‡æ–°ç­†è¨˜ä¸¦é€²å…¥ç·¨è¼¯æ¨¡å¼ã€‚</p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">2ï¸âƒ£ ç·¨è¼¯ç­†è¨˜</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ é»æ“Šç­†è¨˜åˆ—è¡¨ä¸­çš„ä»»ä¸€ç­†è¨˜ï¼Œé è¨­æœƒé€²å…¥ <strong>Markdown æ¨¡å¼</strong>ï¼ˆç´”é–±è®€ï¼‰<br>
                                    â€¢ é»æ“Šå³ä¸‹è§’ã€Œâœï¸ ç·¨è¼¯ã€æŒ‰éˆ•é€²å…¥ç·¨è¼¯æ¨¡å¼<br>
                                    â€¢ åœ¨ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œå·¦å´ç‚ºç·¨è¼¯å™¨ï¼Œå³å´å³æ™‚é è¦½ Markdown æ¸²æŸ“çµæœ<br>
                                    â€¢ å®Œæˆç·¨è¼¯å¾Œé»æ“Šã€Œâœ… å®Œæˆã€è¿”å› Markdown æ¨¡å¼
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">3ï¸âƒ£ æ€ç¶­å°åœ–è¦–åœ–</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ é¸æ“‡ç­†è¨˜å¾Œï¼Œé»æ“Šå³ä¸‹è§’ã€ŒğŸ—ºï¸ æ€ç¶­å°åœ–ã€æŒ‰éˆ•<br>
                                    â€¢ ç­†è¨˜æœƒè‡ªå‹•è½‰æ›ç‚ºå½©è‰²äº’å‹•å¼å¿ƒæ™ºåœ–<br>
                                    â€¢ é»æ“Šç¯€é»åœ“åœˆå¯å±•é–‹/æ”¶èµ·åˆ†æ”¯<br>
                                    â€¢ æ»¾å‹•æ»‘é¼ æ»¾è¼ªå¯ç¸®æ”¾è¦–åœ–<br>
                                    â€¢ æ‹–æ›³å¯ç§»å‹•è¦–åœ–ä½ç½®<br>
                                    â€¢ é»æ“Šã€ŒğŸ“„ è¿”å›é–±è®€ã€è¿”å›æ­£å¸¸è¦–åœ–
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">4ï¸âƒ£ å…¨å±æ¨¡å¼</h4>
                                <p class="text-gray-300 ml-4">
                                    â€¢ åœ¨ Markdown é–±è®€æ¨¡å¼æˆ–æ€ç¶­å°åœ–æ¨¡å¼ä¸‹ï¼Œé»æ“Šå³ä¸Šè§’çš„ â›¶ æŒ‰éˆ•é€²å…¥å…¨å±<br>
                                    â€¢ å…¨å±æ¨¡å¼ä¸‹å¯ä»¥æ›´å°ˆæ³¨åœ°é–±è®€æˆ–æŸ¥çœ‹æ€ç¶­å°åœ–<br>
                                    â€¢ é»æ“Š â›‰ æŒ‰éˆ•æˆ–æŒ‰ ESC éµé€€å‡ºå…¨å±<br>
                                    â€¢ å…¨å±æ¨¡å¼æœƒè‡ªå‹•èª¿æ•´è¦–åœ–å¤§å°ä»¥æœ€ä½³åŒ–é¡¯ç¤º
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">5ï¸âƒ£ åˆªé™¤ç­†è¨˜</h4>
                                <p class="text-gray-300 ml-4">é¸æ“‡ç­†è¨˜å¾Œï¼Œé»æ“Šå³ä¸‹è§’ã€ŒğŸ—‘ï¸ åˆªé™¤ç­†è¨˜ã€æŒ‰éˆ•ï¼Œç¢ºèªå¾Œå³å¯åˆªé™¤ã€‚</p>
                            </div>
                        </div>
                    </section>

                    <!-- æœå°‹åŠŸèƒ½ -->
                    <section>
                        <h3 class="text-xl font-bold text-purple-400 mb-3">ğŸ” æœå°‹åŠŸèƒ½</h3>
                        <div class="text-gray-300 ml-4 space-y-2">
                            <p>â€¢ åœ¨å·¦å´é¢æ¿çš„æœå°‹æ¡†è¼¸å…¥é—œéµå­—</p>
                            <p>â€¢ ç³»çµ±æœƒå³æ™‚æœå°‹ç­†è¨˜æ¨™é¡Œå’Œå…§å®¹</p>
                            <p>â€¢ æœå°‹çµæœæœƒä»¥é»ƒè‰²é«˜äº®é¡¯ç¤ºé—œéµå­—</p>
                            <p>â€¢ é¡¯ç¤ºæ‰¾åˆ°çš„ç­†è¨˜æ•¸é‡çµ±è¨ˆ</p>
                            <p>â€¢ é»æ“Šã€Œâœ•ã€æˆ–æŒ‰ ESC éµæ¸…é™¤æœå°‹</p>
                        </div>
                    </section>

                    <!-- åŒ¯å‡ºåŒ¯å…¥ -->
                    <section>
                        <h3 class="text-xl font-bold text-yellow-400 mb-3">ğŸ’¾ è³‡æ–™å‚™ä»½èˆ‡é‚„åŸ</h3>

                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸ“¤ åŒ¯å‡ºè³‡æ–™</h4>
                                <p class="text-gray-300 ml-4">
                                    é»æ“Šå·¦å´é¢æ¿çš„ã€ŒğŸ“¤ åŒ¯å‡ºã€æŒ‰éˆ•ï¼Œç³»çµ±æœƒå°‡æ‰€æœ‰ç­†è¨˜åŒ¯å‡ºç‚º JSON æ ¼å¼æª”æ¡ˆã€‚<br>
                                    æª”æ¡ˆåç¨±æ ¼å¼ï¼š<code class="bg-gray-700 px-2 py-1 rounded">markdown-notes-backup-YYYY-MM-DD-HH-MM-SS.json</code>
                                </p>
                            </div>

                            <div>
                                <h4 class="font-semibold text-gray-100 mb-2">ğŸ“¥ åŒ¯å…¥è³‡æ–™</h4>
                                <p class="text-gray-300 ml-4">
                                    é»æ“Šå·¦å´é¢æ¿çš„ã€ŒğŸ“¥ åŒ¯å…¥ã€æŒ‰éˆ•ï¼Œé¸æ“‡ä¹‹å‰åŒ¯å‡ºçš„ JSON æª”æ¡ˆã€‚<br>
                                    ç³»çµ±æœƒé¡¯ç¤ºåŒ¯å…¥é è¦½è³‡è¨Šï¼Œä¸¦æä¾›å…©ç¨®åŒ¯å…¥æ¨¡å¼ï¼š<br>
                                    <span class="block mt-2">
                                        â€¢ <strong>è¦†è“‹æ¨¡å¼</strong>ï¼ˆé»æ“Šã€Œç¢ºå®šã€ï¼‰ï¼šåˆªé™¤ç¾æœ‰æ‰€æœ‰ç­†è¨˜ï¼Œå®Œå…¨æ›¿æ›ç‚ºåŒ¯å…¥çš„è³‡æ–™<br>
                                        â€¢ <strong>åˆä½µæ¨¡å¼</strong>ï¼ˆé»æ“Šã€Œå–æ¶ˆã€ï¼‰ï¼šä¿ç•™ç¾æœ‰ç­†è¨˜ï¼Œåªæ–°å¢ä¸é‡è¤‡çš„ç­†è¨˜
                                    </span>
                                </p>
                            </div>
                        </div>
                    </section>

                    <!-- Markdown èªæ³• -->
                    <section>
                        <h3 class="text-xl font-bold text-pink-400 mb-3">ğŸ“ Markdown èªæ³•åƒè€ƒ</h3>
                        <div class="bg-gray-900 p-4 rounded-lg text-sm space-y-3 font-mono text-gray-300">
                            <div>
                                <p class="text-blue-400 mb-1">æ¨™é¡Œï¼š</p>
                                <p># æ¨™é¡Œ 1  ## æ¨™é¡Œ 2  ### æ¨™é¡Œ 3</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">æ–‡å­—æ¨£å¼ï¼š</p>
                                <p>**ç²—é«”** *æ–œé«”* ~~åˆªé™¤ç·š~~</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">åˆ—è¡¨ï¼š</p>
                                <p>- é …ç›®åˆ—è¡¨</p>
                                <p>1. ç·¨è™Ÿåˆ—è¡¨</p>
                                <p>- [ ] ä»»å‹™åˆ—è¡¨ï¼ˆæœªå®Œæˆï¼‰</p>
                                <p>- [x] ä»»å‹™åˆ—è¡¨ï¼ˆå·²å®Œæˆï¼‰</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">é€£çµèˆ‡åœ–ç‰‡ï¼š</p>
                                <p>[é€£çµæ–‡å­—](https://example.com)</p>
                                <p>![åœ–ç‰‡æè¿°](åœ–ç‰‡ç¶²å€)</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">ç¨‹å¼ç¢¼ï¼š</p>
                                <p>`è¡Œå…§ç¨‹å¼ç¢¼`</p>
                                <p>```javascript<br>// ç¨‹å¼ç¢¼å€å¡Šï¼ˆæ”¯æ´èªæ³•é«˜äº®ï¼‰<br>console.log('Hello');<br>```</p>
                                <p class="text-xs text-gray-500 mt-1">* æ€ç¶­å°åœ–ä¸­ï¼Œç¨‹å¼ç¢¼æœƒä»¥æ·±ç°èƒŒæ™¯é¡¯ç¤º</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">å¼•ç”¨èˆ‡åˆ†éš”ç·šï¼š</p>
                                <p>&gt; å¼•ç”¨æ–‡å­—</p>
                                <p>---</p>
                            </div>
                            <div>
                                <p class="text-blue-400 mb-1">è¡¨æ ¼ï¼š</p>
                                <p>| æ¬„ä½1 | æ¬„ä½2 |</p>
                                <p>|-------|-------|</p>
                                <p>| å…§å®¹1 | å…§å®¹2 |</p>
                            </div>
                        </div>
                    </section>

                    <!-- å¿«æ·æç¤º -->
                    <section>
                        <h3 class="text-xl font-bold text-cyan-400 mb-3">ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-300">
                            <li>æ‰€æœ‰è³‡æ–™å„²å­˜åœ¨ç€è¦½å™¨æœ¬åœ°ï¼ˆlocalStorageï¼‰ï¼Œä¸æœƒä¸Šå‚³åˆ°ç¶²è·¯</li>
                            <li>å»ºè­°å®šæœŸä½¿ç”¨ã€ŒåŒ¯å‡ºã€åŠŸèƒ½å‚™ä»½é‡è¦ç­†è¨˜</li>
                            <li>æ¸…é™¤ç€è¦½å™¨è³‡æ–™æœƒå°è‡´ç­†è¨˜éºå¤±ï¼Œè«‹å‹™å¿…å…ˆå‚™ä»½</li>
                            <li>ç­†è¨˜æŒ‰æœ€å¾Œæ›´æ–°æ™‚é–“æ’åºï¼Œæœ€æ–°çš„åœ¨æœ€ä¸Šæ–¹</li>
                            <li>ç·¨è¼¯æ™‚æœƒåœ¨ 1.5 ç§’å¾Œè‡ªå‹•å„²å­˜ï¼Œé¿å…è³‡æ–™éºå¤±</li>
                        </ul>
                    </section>

                    <!-- æŠ€è¡“è³‡è¨Š -->
                    <section class="border-t border-gray-700 pt-4">
                        <h3 class="text-lg font-bold text-gray-400 mb-2">ğŸ”§ æŠ€è¡“è³‡è¨Š</h3>
                        <p class="text-gray-400 text-sm">
                            æœ¬æ‡‰ç”¨ä½¿ç”¨ Tailwind CSSã€marked.jsï¼ˆMarkdown æ¸²æŸ“ï¼‰ã€highlight.jsï¼ˆç¨‹å¼ç¢¼èªæ³•é«˜äº®ï¼‰ã€<br>
                            markmapï¼ˆæ€ç¶­å°åœ–ï¼‰ã€D3.jsï¼ˆè³‡æ–™è¦–è¦ºåŒ–ï¼‰ã€DOMPurifyï¼ˆå®‰å…¨é˜²è­·ï¼‰é–‹ç™¼ã€‚<br>
                            ç´”å‰ç«¯æ‡‰ç”¨ï¼Œç„¡éœ€ä¼ºæœå™¨ï¼Œå¯é›¢ç·šä½¿ç”¨ã€‚
                        </p>
                    </section>
                </div>

                <!-- Modal Footer -->
                <div class="sticky bottom-0 bg-gray-800 border-t border-gray-700 p-4 flex justify-end">
                    <button id="closeHelpBtn2" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg font-semibold">
                        é—œé–‰
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Script started');

        // Configure marked.js for full GFM support
        marked.setOptions({
            gfm: true,              // GitHub Flavored Markdown
            breaks: true,           // Convert \n to <br>
            pedantic: false,
            sanitize: false,        // We use DOMPurify instead
            smartLists: true,
            smartypants: false,
            highlight: function(code, lang) {
                // Use highlight.js for syntax highlighting
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (err) {
                        console.error('Highlight error:', err);
                    }
                }
                return code;
            }
        });

        // State
        let notes = [];
        let currentNoteId = null;
        let autoSaveTimeout = null;
        let isEditMode = true; // true: ç¼–è¾‘æ¨¡å¼, false: é¢„è§ˆæ¨¡å¼
        let isMarkmapView = false; // true: æ€ç»´å¯¼å›¾è§†å›¾, false: æ­£å¸¸è§†å›¾
        let searchQuery = ''; // æœç´¢å…³é”®å­—
        let markmapInstance = null; // Markmapå®ä¾‹
        const markmapTransformer = typeof markmap !== 'undefined' ? new markmap.Transformer() : null;

        // Elements
        const els = {
            newNoteBtn: document.getElementById('newNoteBtn'),
            noteList: document.getElementById('noteList'),
            noteTitle: document.getElementById('noteTitle'),
            noteContent: document.getElementById('noteContent'),
            markdownPreview: document.getElementById('markdownPreview'),
            deleteNoteBtn: document.getElementById('deleteNoteBtn'),
            saveStatus: document.getElementById('saveStatus'),
            toggleModeBtn: document.getElementById('toggleModeBtn'),
            viewModeBtn: document.getElementById('viewModeBtn'),
            editorSection: document.getElementById('editorSection'),
            previewSection: document.getElementById('previewSection'),
            markmapSection: document.getElementById('markmapSection'),
            markmapSvg: document.getElementById('markmapSvg'),
            searchInput: document.getElementById('searchInput'),
            clearSearchBtn: document.getElementById('clearSearchBtn'),
            searchStats: document.getElementById('searchStats'),
            searchCount: document.getElementById('searchCount'),
            noteTimestamp: document.getElementById('noteTimestamp'),
            createdTime: document.getElementById('createdTime'),
            updatedTime: document.getElementById('updatedTime'),
            exportBtn: document.getElementById('exportBtn'),
            importBtn: document.getElementById('importBtn'),
            importFileInput: document.getElementById('importFileInput'),
            helpBtn: document.getElementById('helpBtn'),
            helpModal: document.getElementById('helpModal'),
            closeHelpBtn: document.getElementById('closeHelpBtn'),
            closeHelpBtn2: document.getElementById('closeHelpBtn2'),
            previewFullscreenBtn: document.getElementById('previewFullscreenBtn'),
            markmapFullscreenBtn: document.getElementById('markmapFullscreenBtn')
        };

        // Notes
        function loadNotes() {
            const saved = localStorage.getItem('demo-notes');
            notes = saved ? JSON.parse(saved) : [];
            notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            renderNoteList();
        }

        function saveNotes() {
            localStorage.setItem('demo-notes', JSON.stringify(notes));
        }

        function renderNoteList() {
            // æœç´¢è¿‡æ»¤
            let filteredNotes = notes;
            if (searchQuery.trim()) {
                const query = searchQuery.toLowerCase();
                filteredNotes = notes.filter(note => {
                    const title = (note.title || '').toLowerCase();
                    const content = (note.content || '').toLowerCase();
                    return title.includes(query) || content.includes(query);
                });

                // æ˜¾ç¤ºæœç´¢ç»Ÿè®¡
                els.searchStats.classList.remove('hidden');
                els.searchCount.textContent = filteredNotes.length;
            } else {
                // éšè—æœç´¢ç»Ÿè®¡
                els.searchStats.classList.add('hidden');
            }

            if (notes.length === 0) {
                els.noteList.innerHTML = '<div class="p-4 text-center text-gray-400"><p>å°šç„¡ç­†è¨˜</p></div>';
                return;
            }

            if (filteredNotes.length === 0) {
                els.noteList.innerHTML = '<div class="p-4 text-center text-gray-400"><p>æ‰¾ä¸åˆ°ç¬¦åˆçš„ç­†è¨˜</p><p class="text-xs mt-2">è©¦è©¦å…¶ä»–é—œéµå­—</p></div>';
                return;
            }

            els.noteList.innerHTML = filteredNotes.map(note => {
                const active = note.id === currentNoteId ? 'active' : '';
                const title = highlightText(note.title || 'ç„¡æ¨™é¡Œ', searchQuery);
                const preview = highlightText((note.content || '').substring(0, 50), searchQuery);
                const timeText = formatRelativeTime(note.updatedAt);

                return `
                    <div class="note-list-item p-4 cursor-pointer border-b border-gray-700 ${active}" onclick="selectNote('${note.id}')">
                        <h3 class="font-semibold text-gray-200 truncate">${title}</h3>
                        <p class="text-sm text-gray-400 mt-1 truncate">${preview}</p>
                        <p class="text-xs text-gray-500 mt-1">ğŸ“… ${timeText}</p>
                    </div>
                `;
            }).join('');
        }

        function highlightText(text, query) {
            if (!query.trim()) {
                return escapeHtml(text);
            }

            const escaped = escapeHtml(text);
            const escapedQuery = escapeHtml(query);
            const regex = new RegExp(`(${escapedQuery})`, 'gi');
            return escaped.replace(regex, '<mark class="bg-yellow-500 text-gray-900 px-1 rounded">$1</mark>');
        }

        function performSearch(query) {
            searchQuery = query;
            renderNoteList();

            // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
            if (query.trim()) {
                els.clearSearchBtn.classList.remove('hidden');
            } else {
                els.clearSearchBtn.classList.add('hidden');
            }
        }

        function clearSearch() {
            els.searchInput.value = '';
            performSearch('');
            els.searchInput.focus();
        }

        function createNote() {
            console.log('Creating note...');
            const note = {
                id: Date.now().toString(36),
                title: 'æ–°ç­†è¨˜',
                content: '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            notes.unshift(note);
            saveNotes();
            renderNoteList();

            // æ–°å»ºç¬”è®°æ—¶ç›´æ¥è¿›å…¥ç¼–è¾‘æ¨¡å¼
            currentNoteId = note.id;
            els.noteTitle.value = note.title;
            els.noteContent.value = note.content;
            els.deleteNoteBtn.disabled = false;
            els.toggleModeBtn.disabled = false;
            els.viewModeBtn.disabled = false;
            isMarkmapView = false;
            setEditMode(true);
            renderMarkdown(note.content);
            updateTimestampDisplay(note);
            renderNoteList();
        }

        function selectNote(id) {
            console.log('Selecting note:', id);
            const note = notes.find(n => n.id === id);
            if (!note) return;

            currentNoteId = id;
            els.noteTitle.value = note.title;
            els.noteContent.value = note.content;
            els.deleteNoteBtn.disabled = false;
            els.toggleModeBtn.disabled = false;
            els.viewModeBtn.disabled = false;
            isMarkmapView = false;

            // é»˜è®¤è¿›å…¥é¢„è§ˆæ¨¡å¼ï¼ˆMarkdown æ¸²æŸ“æ¨¡å¼ï¼‰
            setEditMode(false);

            renderMarkdown(note.content);
            updateTimestampDisplay(note);
            renderNoteList();
        }

        function setEditMode(editMode) {
            isEditMode = editMode;

            // å¦‚æœä¹‹å‰åœ¨markmapè§†å›¾ï¼Œå…ˆé€€å‡º
            if (isMarkmapView) {
                isMarkmapView = false;
                els.markmapSection.classList.add('hidden');
                els.markmapSection.classList.remove('flex');
                els.viewModeBtn.innerHTML = 'ğŸ—ºï¸ æ€ç¶­å°åœ–';
                els.viewModeBtn.className = 'bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg';
            }

            if (isEditMode) {
                // ç¼–è¾‘æ¨¡å¼ï¼šæ˜¾ç¤ºç¼–è¾‘å™¨å’ŒMarkdowné¢„è§ˆ
                els.editorSection.classList.remove('hidden');
                els.previewSection.classList.remove('hidden');
                els.noteTitle.disabled = false;
                els.noteContent.disabled = false;
                els.toggleModeBtn.innerHTML = 'âœ… å®Œæˆ';
                els.toggleModeBtn.className = 'bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg';
                els.saveStatus.textContent = 'ç·¨è¼¯æ¨¡å¼';
            } else {
                // Markdown é¢„è§ˆæ¨¡å¼ï¼šåªæ˜¾ç¤ºæ¸²æŸ“ç»“æœ
                els.editorSection.classList.add('hidden');
                els.previewSection.classList.remove('hidden');
                els.noteTitle.disabled = true;
                els.noteContent.disabled = true;
                els.toggleModeBtn.innerHTML = 'âœï¸ ç·¨è¼¯';
                els.toggleModeBtn.className = 'bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg';
                els.saveStatus.textContent = 'Markdown æ¨¡å¼';
            }
        }

        function toggleMode() {
            if (!currentNoteId) return;
            setEditMode(!isEditMode);
        }

        function updateNote(data) {
            const note = notes.find(n => n.id === currentNoteId);
            if (!note) return;

            Object.assign(note, data, { updatedAt: new Date().toISOString() });
            notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            saveNotes();
            renderNoteList();
            updateTimestampDisplay(note);

            // æ˜¾ç¤ºä¿å­˜çŠ¶æ€
            const originalStatus = els.saveStatus.textContent;
            els.saveStatus.textContent = 'å·²å„²å­˜ âœ“';
            setTimeout(() => {
                els.saveStatus.textContent = isEditMode ? 'ç·¨è¼¯æ¨¡å¼' : 'Markdown æ¨¡å¼';
            }, 2000);
        }

        function deleteNote() {
            if (!currentNoteId || !confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç­†è¨˜å—ï¼Ÿ')) return;

            notes = notes.filter(n => n.id !== currentNoteId);
            saveNotes();

            currentNoteId = null;
            els.noteTitle.value = '';
            els.noteContent.value = '';
            els.noteTitle.disabled = true;
            els.noteContent.disabled = true;
            els.deleteNoteBtn.disabled = true;
            els.toggleModeBtn.disabled = true;
            els.viewModeBtn.disabled = true;
            els.saveStatus.textContent = 'è«‹é¸æ“‡æˆ–å»ºç«‹ç­†è¨˜';
            els.markdownPreview.innerHTML = '<p class="text-gray-500">Markdown æ¸²æŸ“å€åŸŸ</p>';
            isMarkmapView = false;
            els.markmapSection.classList.add('hidden');
            els.markmapSection.classList.remove('flex');
            updateTimestampDisplay(null);

            renderNoteList();
        }

        function renderMarkdown(text) {
            try {
                const html = DOMPurify.sanitize(marked.parse(text || ''));
                els.markdownPreview.innerHTML = html || '<p class="text-gray-500">é è¦½å€åŸŸ</p>';
            } catch (e) {
                console.error('Markdown error:', e);
            }
        }

        function renderMarkmap(text) {
            if (!markmapTransformer || !text) {
                return;
            }

            try {
                const { root } = markmapTransformer.transform(text);

                // ä¼˜åŒ–åçš„é…è‰²æ–¹æ¡ˆ - æ›´é²œè‰³ã€å¯¹æ¯”åº¦æ›´é«˜
                const vibrantColors = [
                    '#3b82f6',  // é²œè‰³è“è‰² - ç¬¬ä¸€å±‚ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰
                    '#10b981',  // ç¿ ç»¿è‰² - ç¬¬äºŒå±‚
                    '#f59e0b',  // é‡‘é»„è‰² - ç¬¬ä¸‰å±‚
                    '#ec4899',  // ç²‰çº¢è‰² - ç¬¬å››å±‚
                    '#8b5cf6',  // ç´«è‰² - ç¬¬äº”å±‚
                    '#06b6d4',  // é’è‰² - ç¬¬å…­å±‚
                    '#f97316',  // æ©™è‰² - ç¬¬ä¸ƒå±‚
                    '#14b8a6'   // è“ç»¿è‰² - ç¬¬å…«å±‚
                ];

                const markmapOptions = {
                    duration: 500,
                    nodeFont: '500 18px "Microsoft JhengHei", "Microsoft YaHei", -apple-system, BlinkMacSystemFont, sans-serif',
                    paddingX: 15,
                    spacingVertical: 15,
                    spacingHorizontal: 100,
                    // èŠ‚ç‚¹é¢œè‰²å‡½æ•°
                    color: (node) => {
                        const depth = node.state?.depth || 0;
                        return vibrantColors[depth % vibrantColors.length];
                    },
                    // è‡ªå®šä¹‰æ ·å¼
                    style: (id) => `
                        #${id} {
                            font-family: "Microsoft JhengHei", "Microsoft YaHei", sans-serif;
                        }
                        #${id} .markmap-node > circle {
                            fill: currentColor;
                            stroke: currentColor;
                            filter: brightness(1.2) drop-shadow(0 0 8px currentColor);
                        }
                        #${id} .markmap-link {
                            stroke: currentColor;
                            stroke-width: 2.5px;
                            opacity: 0.5;
                        }
                        #${id} text {
                            fill: #f3f4f6;
                            font-weight: 500;
                            paint-order: stroke fill;
                            stroke: #000;
                            stroke-width: 3px;
                            stroke-linecap: round;
                            stroke-linejoin: round;
                        }
                        #${id} code {
                            background-color: #1e1e1e !important;
                            color: #d4d4d4 !important;
                            padding: 3px 8px !important;
                            border-radius: 4px !important;
                            font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;
                            font-size: 14px !important;
                            font-weight: 400 !important;
                            border: 1px solid #3a3a3a !important;
                            text-shadow: none !important;
                        }
                        #${id} pre {
                            background-color: #1e1e1e !important;
                            color: #d4d4d4 !important;
                            padding: 12px !important;
                            border-radius: 6px !important;
                            border: 1px solid #3a3a3a !important;
                            margin: 4px 0 !important;
                        }
                        #${id} pre code {
                            background-color: transparent !important;
                            border: none !important;
                            padding: 0 !important;
                        }
                    `
                };

                if (markmapInstance) {
                    markmapInstance.setData(root, markmapOptions);
                } else {
                    markmapInstance = markmap.Markmap.create(els.markmapSvg, markmapOptions, root);
                }

                // è‡ªåŠ¨é€‚é…è§†å›¾
                setTimeout(() => {
                    if (markmapInstance && markmapInstance.fit) {
                        markmapInstance.fit();
                    }
                }, 150);
            } catch (e) {
                console.error('Markmap error:', e);
            }
        }

        function toggleViewMode() {
            if (!currentNoteId) return;

            isMarkmapView = !isMarkmapView;

            if (isMarkmapView) {
                // åˆ‡æ¢åˆ°æ€ç»´å¯¼å›¾è§†å›¾
                els.editorSection.classList.add('hidden');
                els.previewSection.classList.add('hidden');
                els.markmapSection.classList.remove('hidden');
                els.markmapSection.classList.add('flex');
                els.viewModeBtn.innerHTML = 'ğŸ“„ è¿”å›é–±è®€';
                els.viewModeBtn.className = 'bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg';

                // æ¸²æŸ“markmap
                const note = notes.find(n => n.id === currentNoteId);
                if (note) {
                    renderMarkmap(note.content);
                }
            } else {
                // è¿”å›æ­£å¸¸è§†å›¾
                els.markmapSection.classList.add('hidden');
                els.markmapSection.classList.remove('flex');

                if (isEditMode) {
                    els.editorSection.classList.remove('hidden');
                    els.previewSection.classList.remove('hidden');
                } else {
                    els.editorSection.classList.add('hidden');
                    els.previewSection.classList.remove('hidden');
                }

                els.viewModeBtn.innerHTML = 'ğŸ—ºï¸ æ€ç¶­å°åœ–';
                els.viewModeBtn.className = 'bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg';
            }
        }

        function debounce(fn, delay) {
            return (...args) => {
                clearTimeout(autoSaveTimeout);
                autoSaveTimeout = setTimeout(() => fn(...args), delay);
            };
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDateTime(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        function formatRelativeTime(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'å‰›å‰›';
            if (diffMins < 60) return `${diffMins} åˆ†é˜å‰`;
            if (diffHours < 24) return `${diffHours} å°æ™‚å‰`;
            if (diffDays < 7) return `${diffDays} å¤©å‰`;

            return formatDateTime(isoString);
        }

        function updateTimestampDisplay(note) {
            if (!note) {
                els.noteTimestamp.classList.add('hidden');
                return;
            }

            els.createdTime.textContent = `å»ºç«‹æ™‚é–“ï¼š${formatDateTime(note.createdAt)}`;
            els.updatedTime.textContent = `æœ€å¾Œæ›´æ–°ï¼š${formatDateTime(note.updatedAt)}`;
            els.noteTimestamp.classList.remove('hidden');
        }

        // Export/Import Functions
        function exportData() {
            try {
                // è·å–æ‰€æœ‰ç¬”è®°æ•°æ®
                const exportData = {
                    version: '1.0',
                    exportDate: new Date().toISOString(),
                    notesCount: notes.length,
                    notes: notes
                };

                // è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²
                const jsonString = JSON.stringify(exportData, null, 2);

                // åˆ›å»º Blob å¯¹è±¡
                const blob = new Blob([jsonString], { type: 'application/json' });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;

                // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«æ—¥æœŸæ—¶é—´ï¼‰
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-');
                a.download = `markdown-notes-backup-${dateStr}-${timeStr}.json`;

                // è§¦å‘ä¸‹è½½
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const originalStatus = els.saveStatus.textContent;
                els.saveStatus.textContent = `âœ… å·²åŒ¯å‡º ${notes.length} ç­†ç­†è¨˜`;
                setTimeout(() => {
                    els.saveStatus.textContent = originalStatus;
                }, 3000);

                console.log('Data exported successfully:', exportData);
            } catch (error) {
                console.error('Export error:', error);
                alert('åŒ¯å‡ºå¤±æ•—ï¼š' + error.message);
            }
        }

        function importData() {
            // è§¦å‘æ–‡ä»¶é€‰æ‹©
            els.importFileInput.click();
        }

        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.name.endsWith('.json')) {
                alert('è«‹é¸æ“‡ JSON æ ¼å¼çš„æª”æ¡ˆ');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!importedData.notes || !Array.isArray(importedData.notes)) {
                        throw new Error('ç„¡æ•ˆçš„è³‡æ–™æ ¼å¼ï¼šæ‰¾ä¸åˆ° notes é™£åˆ—');
                    }

                    // è¯¢é—®ç”¨æˆ·å¯¼å…¥æ–¹å¼
                    const choice = confirm(
                        `å³å°‡åŒ¯å…¥ ${importedData.notesCount || importedData.notes.length} ç­†ç­†è¨˜\n\n` +
                        `åŒ¯å‡ºæ—¥æœŸï¼š${importedData.exportDate ? new Date(importedData.exportDate).toLocaleString('zh-TW') : 'æœªçŸ¥'}\n\n` +
                        `é»æ“Šã€Œç¢ºå®šã€å°‡è¦†è“‹ç¾æœ‰è³‡æ–™\n` +
                        `é»æ“Šã€Œå–æ¶ˆã€å°‡åˆä½µè³‡æ–™ï¼ˆä¿ç•™ç¾æœ‰ç­†è¨˜ï¼‰`
                    );

                    let finalNotes = [];
                    let importedCount = 0;

                    if (choice) {
                        // è¦†ç›–æ¨¡å¼ï¼šæ›¿æ¢æ‰€æœ‰æ•°æ®
                        finalNotes = importedData.notes;
                        importedCount = finalNotes.length;
                    } else {
                        // åˆå¹¶æ¨¡å¼ï¼šä¿ç•™ç°æœ‰æ•°æ®ï¼Œæ·»åŠ æ–°æ•°æ®
                        const existingIds = new Set(notes.map(n => n.id));
                        const newNotes = importedData.notes.filter(note => !existingIds.has(note.id));
                        finalNotes = [...notes, ...newNotes];
                        importedCount = newNotes.length;
                    }

                    // æ›´æ–° notes æ•°ç»„
                    notes = finalNotes;

                    // æ’åºå¹¶ä¿å­˜
                    notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
                    saveNotes();
                    renderNoteList();

                    // æ¸…é™¤å½“å‰ç¼–è¾‘
                    if (currentNoteId && !notes.find(n => n.id === currentNoteId)) {
                        currentNoteId = null;
                        els.noteTitle.value = '';
                        els.noteContent.value = '';
                        els.noteTitle.disabled = true;
                        els.noteContent.disabled = true;
                        els.deleteNoteBtn.disabled = true;
                        els.toggleModeBtn.disabled = true;
                        els.viewModeBtn.disabled = true;
                        els.markdownPreview.innerHTML = '<p class="text-gray-500">Markdown æ¸²æŸ“å€åŸŸ</p>';
                        isMarkmapView = false;
                        els.markmapSection.classList.add('hidden');
                        updateTimestampDisplay(null);
                    }

                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    const mode = choice ? 'è¦†è“‹' : 'åˆä½µ';
                    els.saveStatus.textContent = `âœ… å·²${mode}åŒ¯å…¥ ${importedCount} ç­†ç­†è¨˜`;
                    setTimeout(() => {
                        els.saveStatus.textContent = 'è«‹é¸æ“‡æˆ–å»ºç«‹ç­†è¨˜';
                    }, 3000);

                    console.log(`Data imported successfully (${mode} mode):`, { importedCount, totalNotes: notes.length });

                } catch (error) {
                    console.error('Import error:', error);
                    alert('åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
                }

                // é‡ç½®æ–‡ä»¶è¾“å…¥
                event.target.value = '';
            };

            reader.onerror = () => {
                alert('è®€å–æª”æ¡ˆå¤±æ•—');
                event.target.value = '';
            };

            reader.readAsText(file);
        }

        // Help Modal Functions
        function openHelpModal() {
            els.helpModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
        }

        function closeHelpModal() {
            els.helpModal.classList.add('hidden');
            document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
        }

        // Fullscreen Functions
        function toggleFullscreen(section, btn) {
            const isFullscreen = section.classList.contains('fullscreen-mode');

            if (isFullscreen) {
                // é€€å‡ºå…¨å±
                section.classList.remove('fullscreen-mode');
                btn.innerHTML = 'â›¶';
                btn.title = 'å…¨å±æŸ¥çœ‹';
                document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨

                // å¦‚æœæ˜¯æ€ç»´å¯¼å›¾ï¼Œéœ€è¦é‡æ–°é€‚é…è§†å›¾
                if (section === els.markmapSection && markmapInstance) {
                    setTimeout(() => {
                        if (markmapInstance && markmapInstance.fit) {
                            markmapInstance.fit();
                        }
                    }, 150);
                }
            } else {
                // è¿›å…¥å…¨å±
                section.classList.add('fullscreen-mode');
                btn.innerHTML = 'â›‰';
                btn.title = 'é€€å‡ºå…¨å± (ESC)';
                document.body.style.overflow = 'hidden'; // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨

                // å¦‚æœæ˜¯æ€ç»´å¯¼å›¾ï¼Œéœ€è¦é‡æ–°é€‚é…è§†å›¾
                if (section === els.markmapSection && markmapInstance) {
                    setTimeout(() => {
                        if (markmapInstance && markmapInstance.fit) {
                            markmapInstance.fit();
                        }
                    }, 150);
                }
            }
        }

        function exitAllFullscreen() {
            // é€€å‡ºæ‰€æœ‰å…¨å±
            if (els.previewSection.classList.contains('fullscreen-mode')) {
                toggleFullscreen(els.previewSection, els.previewFullscreenBtn);
            }
            if (els.markmapSection.classList.contains('fullscreen-mode')) {
                toggleFullscreen(els.markmapSection, els.markmapFullscreenBtn);
            }
        }

        // Make selectNote global
        window.selectNote = selectNote;

        // Event listeners
        els.newNoteBtn.addEventListener('click', createNote);
        els.deleteNoteBtn.addEventListener('click', deleteNote);
        els.toggleModeBtn.addEventListener('click', toggleMode);
        els.viewModeBtn.addEventListener('click', toggleViewMode);

        // Export/Import events
        els.exportBtn.addEventListener('click', exportData);
        els.importBtn.addEventListener('click', importData);
        els.importFileInput.addEventListener('change', handleImportFile);

        // Help Modal events
        els.helpBtn.addEventListener('click', openHelpModal);
        els.closeHelpBtn.addEventListener('click', closeHelpModal);
        els.closeHelpBtn2.addEventListener('click', closeHelpModal);

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        els.helpModal.addEventListener('click', (e) => {
            if (e.target === els.helpModal) {
                closeHelpModal();
            }
        });

        // Fullscreen events
        els.previewFullscreenBtn.addEventListener('click', () => {
            toggleFullscreen(els.previewSection, els.previewFullscreenBtn);
        });

        els.markmapFullscreenBtn.addEventListener('click', () => {
            toggleFullscreen(els.markmapSection, els.markmapFullscreenBtn);
        });

        // ESC é”®å…³é—­æ¨¡æ€æ¡†æˆ–é€€å‡ºå…¨å±
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // ä¼˜å…ˆå…³é—­å¸®åŠ©æ¨¡æ€æ¡†
                if (!els.helpModal.classList.contains('hidden')) {
                    closeHelpModal();
                }
                // ç„¶åé€€å‡ºå…¨å±
                else if (els.previewSection.classList.contains('fullscreen-mode') ||
                         els.markmapSection.classList.contains('fullscreen-mode')) {
                    exitAllFullscreen();
                }
                // æœ€åæ¸…é™¤æœç´¢
                else if (els.searchInput.value) {
                    clearSearch();
                }
            }
        });

        // Search events
        els.searchInput.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });

        els.clearSearchBtn.addEventListener('click', clearSearch);

        const debouncedSave = debounce((data) => updateNote(data), 1500);

        els.noteTitle.addEventListener('input', (e) => {
            debouncedSave({ title: e.target.value });
            renderNoteList();
        });

        els.noteContent.addEventListener('input', (e) => {
            debouncedSave({ content: e.target.value });
            renderMarkdown(e.target.value);
        });

        // Initialize
        loadNotes();
        console.log('App ready!');
    </script>
</body>
</html>
